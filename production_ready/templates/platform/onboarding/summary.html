{% extends "platform/onboarding/base.html" %}

{% block title %}Récapitulatif - Étape 5/5{% endblock %}

{% block onboarding_content %}
<div class="onboarding-step" data-step="5">
    <div class="onboarding-header">
        <div class="onboarding-progress">
            <div class="onboarding-progress-bar" style="width: 100%;"></div>
        </div>
        <div class="onboarding-step-indicator">Étape 5 sur 5</div>
    </div>

    <div class="onboarding-content">
        <div class="onboarding-welcome">
            <div class="onboarding-welcome-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <h1>Félicitations !</h1>
            <p class="onboarding-subtitle">
                Votre profil est maintenant configuré. Voici un récapitulatif de vos informations.
            </p>
        </div>

        <div class="onboarding-summary">
            <div class="onboarding-summary-section">
                <h3>
                    <i class="fas fa-user"></i>
                    Profil Personnel
                </h3>
                <div class="onboarding-summary-grid">
                    <div class="onboarding-summary-item">
                        <span class="label">Âge :</span>
                        <span class="value" id="summaryAge">-</span>
                    </div>
                    <div class="onboarding-summary-item">
                        <span class="label">Situation :</span>
                        <span class="value" id="summarySituation">-</span>
                    </div>
                    <div class="onboarding-summary-item">
                        <span class="label">Profession :</span>
                        <span class="value" id="summaryProfession">-</span>
                    </div>
                    <div class="onboarding-summary-item">
                        <span class="label">Revenus :</span>
                        <span class="value" id="summaryIncome">-</span>
                    </div>
                </div>
            </div>

            <div class="onboarding-summary-section">
                <h3>
                    <i class="fas fa-bullseye"></i>
                    Objectifs Patrimoniaux
                </h3>
                <div class="onboarding-summary-objectives" id="summaryObjectives">
                    <!-- Objectives will be populated by JS -->
                </div>
                <div class="onboarding-summary-item">
                    <span class="label">Horizon d'investissement :</span>
                    <span class="value" id="summaryHorizon">-</span>
                </div>
            </div>

            <div class="onboarding-summary-section">
                <h3>
                    <i class="fas fa-chart-line"></i>
                    Profil de Risque
                </h3>
                <div class="onboarding-risk-result">
                    <div class="onboarding-risk-badge">
                        <div class="onboarding-risk-icon">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <div class="onboarding-risk-content">
                            <h4 id="summaryRiskTitle">Profil en cours de calcul...</h4>
                            <p id="summaryRiskDescription">-</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="onboarding-next-steps">
            <h3>Prochaines étapes</h3>
            <div class="onboarding-next-steps-grid">
                <div class="onboarding-next-step">
                    <div class="onboarding-next-step-icon">
                        <i class="fas fa-chart-pie"></i>
                    </div>
                    <div class="onboarding-next-step-content">
                        <h4>Analyse de votre situation</h4>
                        <p>Nous allons analyser votre profil pour vous proposer des recommandations personnalisées.</p>
                    </div>
                </div>

                <div class="onboarding-next-step">
                    <div class="onboarding-next-step-icon">
                        <i class="fas fa-lightbulb"></i>
                    </div>
                    <div class="onboarding-next-step-content">
                        <h4>Recommandations sur mesure</h4>
                        <p>Recevez des conseils d'investissement adaptés à vos objectifs et votre profil de risque.</p>
                    </div>
                </div>

                <div class="onboarding-next-step">
                    <div class="onboarding-next-step-icon">
                        <i class="fas fa-handshake"></i>
                    </div>
                    <div class="onboarding-next-step-content">
                        <h4>Accompagnement personnalisé</h4>
                        <p>Bénéficiez du suivi de nos conseillers pour optimiser votre stratégie patrimoniale.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="onboarding-actions">
        <a href="{{ url_for('platform_onboarding.risk_profile') }}" class="onboarding-btn-back">
            <i class="fas fa-arrow-left"></i>
            <span>Retour</span>
        </a>
        
        <button type="button" class="onboarding-btn-next" id="finishBtn">
            <span>Accéder à ma plateforme</span>
            <i class="fas fa-rocket"></i>
        </button>
    </div>
</div>

<style>
.onboarding-summary {
    display: grid;
    gap: 32px;
    margin-bottom: 40px;
}

.onboarding-summary-section {
    background: var(--qlower-bg-light);
    border-radius: 16px;
    padding: 24px;
    border: 1px solid var(--qlower-border);
}

.onboarding-summary-section h3 {
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 18px;
    font-weight: 600;
    color: var(--qlower-dark);
    margin-bottom: 20px;
}

.onboarding-summary-section h3 i {
    color: var(--qlower-primary);
}

.onboarding-summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
}

.onboarding-summary-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 16px;
    background: var(--qlower-white);
    border-radius: 12px;
    border: 1px solid var(--qlower-border);
}

.onboarding-summary-item .label {
    font-weight: 500;
    color: var(--qlower-text-light);
    font-size: 14px;
}

.onboarding-summary-item .value {
    font-weight: 600;
    color: var(--qlower-dark);
    font-size: 14px;
}

.onboarding-summary-objectives {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 16px;
}

.onboarding-objective-tag {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 8px 12px;
    background: var(--qlower-white);
    border: 1px solid var(--qlower-primary);
    border-radius: 20px;
    font-size: 13px;
    font-weight: 500;
    color: var(--qlower-primary);
}

.onboarding-objective-tag i {
    font-size: 12px;
}

.onboarding-next-steps {
    margin-top: 40px;
}

.onboarding-next-steps h3 {
    font-size: 20px;
    font-weight: 700;
    color: var(--qlower-dark);
    margin-bottom: 24px;
    text-align: center;
}

.onboarding-next-steps-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
}

.onboarding-next-step {
    display: flex;
    gap: 16px;
    padding: 20px;
    background: var(--qlower-white);
    border-radius: 16px;
    border: 1px solid var(--qlower-border);
    transition: all 0.3s ease;
}

.onboarding-next-step:hover {
    transform: translateY(-2px);
    box-shadow: var(--onboarding-card-shadow);
}

.onboarding-next-step-icon {
    width: 48px;
    height: 48px;
    background: var(--onboarding-gradient);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 20px;
    flex-shrink: 0;
}

.onboarding-next-step-content h4 {
    font-size: 16px;
    font-weight: 600;
    color: var(--qlower-dark);
    margin-bottom: 8px;
}

.onboarding-next-step-content p {
    font-size: 14px;
    color: var(--qlower-text-light);
    line-height: 1.5;
    margin: 0;
}

@media (max-width: 768px) {
    .onboarding-summary-grid {
        grid-template-columns: 1fr;
    }
    
    .onboarding-next-steps-grid {
        grid-template-columns: 1fr;
    }
    
    .onboarding-next-step {
        flex-direction: column;
        text-align: center;
    }
}
</style>
{% endblock %}

{% block onboarding_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const step = document.querySelector('.onboarding-step');
    step.classList.add('animate-in');
    
    const finishBtn = document.getElementById('finishBtn');
    
    // Données de traduction pour l'affichage
    const translations = {
        age: {
            '18-25': '18-25 ans',
            '26-35': '26-35 ans', 
            '36-45': '36-45 ans',
            '46-55': '46-55 ans',
            '56-65': '56-65 ans',
            '65+': 'Plus de 65 ans'
        },
        situation: {
            'single': 'Célibataire',
            'couple': 'En couple',
            'married': 'Marié(e)',
            'divorced': 'Divorcé(e)',
            'widowed': 'Veuf/Veuve'
        },
        profession: {
            'employee': 'Salarié(e)',
            'executive': 'Cadre/Dirigeant',
            'freelance': 'Indépendant',
            'entrepreneur': 'Entrepreneur',
            'civil_servant': 'Fonctionnaire',
            'retired': 'Retraité(e)',
            'student': 'Étudiant(e)',
            'other': 'Autre'
        },
        income: {
            '0-25000': 'Moins de 25 000€',
            '25000-40000': '25 000€ - 40 000€',
            '40000-60000': '40 000€ - 60 000€',
            '60000-80000': '60 000€ - 80 000€',
            '80000-120000': '80 000€ - 120 000€',
            '120000-200000': '120 000€ - 200 000€',
            '200000+': 'Plus de 200 000€'
        },
        horizon: {
            'short': 'Court terme (moins de 3 ans)',
            'medium': 'Moyen terme (3 à 8 ans)',
            'long': 'Long terme (plus de 8 ans)'
        },
        objectives: {
            'retirement': { icon: 'fas fa-umbrella', text: 'Préparer la retraite' },
            'property': { icon: 'fas fa-home', text: 'Acquérir un bien immobilier' },
            'children': { icon: 'fas fa-graduation-cap', text: 'Financer les études' },
            'emergency': { icon: 'fas fa-shield-alt', text: 'Épargne de précaution' },
            'growth': { icon: 'fas fa-chart-line', text: 'Faire fructifier le capital' },
            'tax': { icon: 'fas fa-calculator', text: 'Optimiser la fiscalité' },
            'transmission': { icon: 'fas fa-heart', text: 'Préparer la transmission' },
            'project': { icon: 'fas fa-lightbulb', text: 'Financer un projet' }
        }
    };
    
    const riskProfiles = {
        conservative: {
            title: "Profil Prudent",
            description: "Vous privilégiez la sécurité et la préservation de votre capital."
        },
        moderate: {
            title: "Profil Équilibré", 
            description: "Vous acceptez un risque modéré pour obtenir un meilleur rendement."
        },
        dynamic: {
            title: "Profil Dynamique",
            description: "Vous acceptez une volatilité plus importante pour maximiser le potentiel de rendement."
        }
    };
    
    // Récupérer les données stockées (simulation)
    // En production, ces données seraient récupérées depuis le serveur
    function loadSummaryData() {
        // Simulation des données - remplacer par des appels API réels
        const mockData = {
            age: '26-35',
            situation: 'couple',
            profession: 'executive', 
            income: '60000-80000',
            objectives: ['retirement', 'property', 'growth'],
            horizon: 'long'
        };
        
        const riskProfile = sessionStorage.getItem('riskProfile') || 'moderate';
        
        // Remplir le résumé
        document.getElementById('summaryAge').textContent = translations.age[mockData.age] || mockData.age;
        document.getElementById('summarySituation').textContent = translations.situation[mockData.situation] || mockData.situation;
        document.getElementById('summaryProfession').textContent = translations.profession[mockData.profession] || mockData.profession;
        document.getElementById('summaryIncome').textContent = translations.income[mockData.income] || mockData.income;
        document.getElementById('summaryHorizon').textContent = translations.horizon[mockData.horizon] || mockData.horizon;
        
        // Afficher les objectifs
        const objectivesContainer = document.getElementById('summaryObjectives');
        objectivesContainer.innerHTML = '';
        
        mockData.objectives.forEach(obj => {
            if (translations.objectives[obj]) {
                const tag = document.createElement('div');
                tag.className = 'onboarding-objective-tag';
                tag.innerHTML = `
                    <i class="${translations.objectives[obj].icon}"></i>
                    ${translations.objectives[obj].text}
                `;
                objectivesContainer.appendChild(tag);
            }
        });
        
        // Afficher le profil de risque
        if (riskProfiles[riskProfile]) {
            document.getElementById('summaryRiskTitle').textContent = riskProfiles[riskProfile].title;
            document.getElementById('summaryRiskDescription').textContent = riskProfiles[riskProfile].description;
        }
    }
    
    // Charger les données
    loadSummaryData();
    
    // Animation des sections
    setTimeout(() => {
        const sections = document.querySelectorAll('.onboarding-summary-section');
        sections.forEach((section, index) => {
            setTimeout(() => {
                section.style.opacity = '1';
                section.style.transform = 'translateY(0)';
            }, index * 200);
        });
        
        // Animation des prochaines étapes
        setTimeout(() => {
            const steps = document.querySelectorAll('.onboarding-next-step');
            steps.forEach((step, index) => {
                setTimeout(() => {
                    step.style.opacity = '1';
                    step.style.transform = 'translateY(0)';
                }, index * 150);
            });
        }, 600);
    }, 500);
    
    // Action du bouton terminer
    finishBtn.addEventListener('click', function() {
        // Sauvegarder l'onboarding comme terminé
        sessionStorage.setItem('onboardingCompleted', 'true');
        
        // Rediriger vers le dashboard
        window.location.href = "{{ url_for('platform_investor.dashboard') }}";
    });
});
</script>
{% endblock %}