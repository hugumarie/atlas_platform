{% extends "admin/base.html" %}

{% block title %}{{ user.first_name }} {{ user.last_name }} - Atlas Admin{% endblock %}

{% block page_title %}
<div class="page-title-responsive">
    <span>üî• NOUVEAU DESIGN - Profil Utilisateur : {{ user.first_name }} {{ user.last_name }}</span>
    <a href="{{ url_for('platform_admin.users') }}" class="admin-btn admin-btn-secondary">
        <i class="fas fa-arrow-left"></i>
        Retour √† la liste
    </a>
</div>
{% endblock %}

{% block content %}
{% if user.investor_profile %}

{% if edit_mode %}
<!-- MODE √âDITION ADMIN √âTENDU -->
<div class="edit-mode-container">
    <div class="edit-header mb-4">
        <div class="alert alert-warning">
            <i class="fas fa-user-shield me-2"></i>
            <strong>Mode √©dition administrateur :</strong> Vous modifiez le profil complet de {{ user.first_name }} {{ user.last_name }}.
        </div>
    </div>
    
    <form id="adminEditFormExtended" method="POST" action="{{ url_for('platform_admin.update_user_data', user_id=user.id) }}">
        
        <!-- Section 1: IDENTIT√â -->
        <div class="platform-card mb-4">
            <div class="platform-card-header">
                <h3 class="platform-card-title">
                    IDENTIT√â
                </h3>
                <p class="platform-card-subtitle">Informations personnelles compl√®tes</p>
            </div>
            <div class="platform-card-body">
                <div class="financial-edit-grid">
                    <!-- Ligne 1: Civilit√© + Nom + Pr√©nom -->
                    <div class="financial-edit-item">
                        <label class="financial-label">Civilit√© *</label>
                        <select class="form-control" name="civilite" required>
                            <option value="">Choisir...</option>
                            <option value="M." {{ 'selected' if user.investor_profile.civilite == 'M.' }}>M.</option>
                            <option value="Mme" {{ 'selected' if user.investor_profile.civilite == 'Mme' }}>Mme</option>
                        </select>
                    </div>
                    <div class="financial-edit-item">
                        <label class="financial-label">Nom *</label>
                        <input type="text" class="form-control" name="last_name" 
                               value="{{ user.last_name }}" required>
                    </div>
                    <div class="financial-edit-item">
                        <label class="financial-label">Pr√©nom *</label>
                        <input type="text" class="form-control" name="first_name" 
                               value="{{ user.first_name }}" required>
                    </div>
                    
                    <!-- Ligne 2: Email + T√©l√©phone + Nationalit√© -->
                    <div class="financial-edit-item">
                        <label class="financial-label">Email</label>
                        <input type="email" class="form-control" value="{{ user.email }}" disabled>
                        <small class="text-muted">L'email ne peut pas √™tre modifi√©</small>
                    </div>
                    <div class="financial-edit-item">
                        <label class="financial-label">Num√©ro de t√©l√©phone</label>
                        <input type="tel" class="form-control" name="phone" 
                               value="{{ user.phone or '' }}" placeholder="Ex: +33 1 23 45 67 89">
                    </div>
                    <div class="financial-edit-item">
                        <label class="financial-label">Nationalit√© *</label>
                        <select class="form-control" name="nationalite" required>
                            <option value="">Choisir...</option>
                            <option value="Fran√ßaise" {{ 'selected' if user.investor_profile.nationalite == 'Fran√ßaise' }}>Fran√ßaise</option>
                            <option value="Union Europ√©enne" {{ 'selected' if user.investor_profile.nationalite == 'Union Europ√©enne' }}>Union Europ√©enne</option>
                            <option value="Autre" {{ 'selected' if user.investor_profile.nationalite == 'Autre' }}>Autre</option>
                        </select>
                    </div>
                    
                    <!-- Ligne 3: Date de naissance + Lieu de naissance + Pays r√©sidence -->
                    <div class="financial-edit-item">
                        <label class="financial-label">Date de naissance *</label>
                        <input type="date" class="form-control" name="date_naissance" 
                               value="{{ user.investor_profile.date_naissance.strftime('%Y-%m-%d') if user.investor_profile.date_naissance }}">
                    </div>
                    <div class="financial-edit-item">
                        <label class="financial-label">Lieu de naissance</label>
                        <input type="text" class="form-control" name="lieu_naissance" 
                               value="{{ user.investor_profile.lieu_naissance or '' }}" placeholder="Ville, Pays">
                    </div>
                    <div class="financial-edit-item">
                        <label class="financial-label">Pays de r√©sidence *</label>
                        <input type="text" class="form-control" name="pays_residence" 
                               value="{{ user.investor_profile.pays_residence or 'France' }}">
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 2: REVENUS COMPL√âMENTAIRES -->
        <div class="platform-card mb-4">
            <div class="platform-card-header">
                <h3 class="platform-card-title">
                    REVENUS COMPL√âMENTAIRES
                </h3>
                <p class="platform-card-subtitle">Sources de revenus suppl√©mentaires</p>
            </div>
            <div class="platform-card-body">
                <div class="revenus-edit-grid" id="revenusGrid">
                    {% for revenu in user.investor_profile.revenus_complementaires_data %}
                    <div class="revenu-edit-item">
                        <div class="financial-edit-item">
                            <label class="financial-label">Type de revenu</label>
                            <input type="text" class="form-control" name="revenu_complementaire_name[]" 
                                   value="{{ revenu.name }}" placeholder="Ex: Loyers, Dividendes...">
                        </div>
                        <div class="financial-edit-item">
                            <label class="financial-label">Montant mensuel</label>
                            <div class="input-group">
                                <input type="number" class="form-control" name="revenu_complementaire_amount[]" 
                                       value="{{ revenu.amount }}" step="0.01" min="0">
                                <span class="input-group-text">‚Ç¨</span>
                            </div>
                        </div>
                        <div class="financial-edit-item">
                            <button type="button" class="btn btn-sm btn-danger" onclick="removeRevenuItem(this)">
                                <i class="fas fa-trash"></i> Supprimer
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                    
                    <div class="patrimoine-edit-item add-revenu-grid-item" id="addRevenuGridItem">
                        <div class="patrimoine-checkbox add-revenu-checkbox" onclick="addRevenuInline()">
                            <div class="add-revenu-content">
                                <i class="fas fa-plus"></i>
                                <span>Ajouter un revenu</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 3: CHARGES -->
        <div class="platform-card mb-4">
            <div class="platform-card-header">
                <h3 class="platform-card-title">
                    CHARGES
                </h3>
                <p class="platform-card-subtitle">Charges et d√©penses mensuelles</p>
            </div>
            <div class="platform-card-body">
                <div class="charges-edit-grid" id="chargesGrid">
                    {% for charge in user.investor_profile.charges_data %}
                    <div class="charge-edit-item">
                        <div class="financial-edit-item">
                            <label class="financial-label">Type de charge</label>
                            <input type="text" class="form-control" name="charge_name[]" 
                                   value="{{ charge.name }}" placeholder="Ex: Cr√©dit immobilier, Assurances...">
                        </div>
                        <div class="financial-edit-item">
                            <label class="financial-label">Montant mensuel</label>
                            <div class="input-group">
                                <input type="number" class="form-control" name="charge_amount[]" 
                                       value="{{ charge.amount }}" step="0.01" min="0">
                                <span class="input-group-text">‚Ç¨</span>
                            </div>
                        </div>
                        <div class="financial-edit-item">
                            <button type="button" class="btn btn-sm btn-danger" onclick="removeChargeItem(this)">
                                <i class="fas fa-trash"></i> Supprimer
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                    
                    <div class="patrimoine-edit-item add-charge-grid-item" id="addChargeGridItem">
                        <div class="patrimoine-checkbox add-charge-checkbox" onclick="addChargeInline()">
                            <div class="add-charge-content">
                                <i class="fas fa-plus"></i>
                                <span>Ajouter une charge</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 4: LIQUIDIT√âS -->
        <div class="platform-card mb-4">
            <div class="platform-card-header">
                <h3 class="platform-card-title">
                    LIQUIDIT√âS
                </h3>
                <p class="platform-card-subtitle">Comptes et liquidit√©s disponibles</p>
            </div>
            <div class="platform-card-body">
                <div class="liquidites-edit-grid" id="liquiditesGrid">
                    <!-- Livret A -->
                    <div class="patrimoine-edit-item">
                        <div class="patrimoine-checkbox">
                            <input type="checkbox" id="admin_has_livret_a" name="has_livret_a" 
                                   {{ 'checked' if user.investor_profile.has_livret_a }} 
                                   onchange="togglePatrimoineField('livret_a')">
                            <label for="admin_has_livret_a" class="patrimoine-label">
                                <i class="fas fa-piggy-bank"></i>
                                Livret A
                            </label>
                        </div>
                        <div class="patrimoine-value">
                            <div class="input-group">
                                <input type="number" class="form-control" name="livret_a_value" 
                                       value="{{ user.investor_profile.livret_a_value if user.investor_profile.has_livret_a else 0 }}" 
                                       step="0.01" min="0" id="livret_a_value" 
                                       {{ 'disabled' if not user.investor_profile.has_livret_a }}>
                                <span class="input-group-text">‚Ç¨</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Compte Courant -->
                    <div class="patrimoine-edit-item">
                        <div class="patrimoine-checkbox">
                            <input type="checkbox" id="admin_has_current_account" name="has_current_account" 
                                   {{ 'checked' if user.investor_profile.has_current_account }}
                                   onchange="togglePatrimoineField('current_account')">
                            <label for="admin_has_current_account" class="patrimoine-label">
                                <i class="fas fa-credit-card"></i>
                                Compte courant
                            </label>
                        </div>
                        <div class="patrimoine-value">
                            <div class="input-group">
                                <input type="number" class="form-control" name="current_account_value" 
                                       value="{{ user.investor_profile.current_account_value if user.investor_profile.has_current_account else 0 }}" 
                                       step="0.01" min="0" id="current_account_value"
                                       {{ 'disabled' if not user.investor_profile.has_current_account }}>
                                <span class="input-group-text">‚Ç¨</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Liquidit√©s personnalis√©es -->
                    {% for liquidite in user.investor_profile.liquidites_personnalisees_data %}
                    <div class="patrimoine-edit-item liquidite-personnalisee-item">
                        <div class="patrimoine-checkbox">
                            <input type="checkbox" checked>
                            <label class="patrimoine-label">
                                <i class="fas fa-coins"></i>
                                {{ liquidite.name }}
                            </label>
                        </div>
                        <div class="patrimoine-value">
                            <div class="input-group">
                                <input type="text" class="form-control liquidite-name-input" name="liquidite_personnalisee_name[]" 
                                       value="{{ liquidite.name }}" placeholder="Nom de la liquidit√©">
                                <input type="number" class="form-control" name="liquidite_personnalisee_amount[]" 
                                       value="{{ liquidite.amount }}" step="0.01" min="0">
                                <span class="input-group-text">‚Ç¨</span>
                                <button type="button" class="btn btn-danger btn-sm" onclick="removeLiquiditeItem(this)">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    
                    <div class="patrimoine-edit-item add-liquidite-grid-item" id="addLiquiditeGridItem">
                        <div class="patrimoine-checkbox add-liquidite-checkbox" onclick="addLiquiditeInline()">
                            <div class="add-liquidite-content">
                                <i class="fas fa-plus"></i>
                                <span>Ajouter une liquidit√©</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Total Liquidit√©s -->
                <div class="total-section">
                    <div class="total-display">
                        <i class="fas fa-coins"></i> <span id="totalLiquidites">0‚Ç¨</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 5: PLACEMENTS FINANCIERS -->
        <div class="platform-card mb-4">
            <div class="platform-card-header">
                <h3 class="platform-card-title">
                    PLACEMENTS FINANCIERS
                </h3>
                <p class="platform-card-subtitle">Investissements et placements</p>
            </div>
            <div class="platform-card-body">
                <div class="placements-edit-grid" id="placementsGrid">
                    <!-- PEA -->
                    <div class="patrimoine-edit-item">
                        <div class="patrimoine-checkbox">
                            <input type="checkbox" id="admin_has_pea" name="has_pea" 
                                   {{ 'checked' if user.investor_profile.has_pea }}
                                   onchange="togglePatrimoineField('pea')">
                            <label for="admin_has_pea" class="patrimoine-label">
                                <i class="fas fa-chart-line"></i>
                                PEA
                            </label>
                        </div>
                        <div class="patrimoine-value">
                            <div class="input-group">
                                <input type="number" class="form-control" name="pea_value" 
                                       value="{{ user.investor_profile.pea_value if user.investor_profile.has_pea else 0 }}" 
                                       step="0.01" min="0" id="pea_value"
                                       {{ 'disabled' if not user.investor_profile.has_pea }}>
                                <span class="input-group-text">‚Ç¨</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- PER -->
                    <div class="patrimoine-edit-item">
                        <div class="patrimoine-checkbox">
                            <input type="checkbox" id="admin_has_per" name="has_per" 
                                   {{ 'checked' if user.investor_profile.has_per }}
                                   onchange="togglePatrimoineField('per')">
                            <label for="admin_has_per" class="patrimoine-label">
                                <i class="fas fa-university"></i>
                                PER
                            </label>
                        </div>
                        <div class="patrimoine-value">
                            <div class="input-group">
                                <input type="number" class="form-control" name="per_value" 
                                       value="{{ user.investor_profile.per_value if user.investor_profile.has_per else 0 }}" 
                                       step="0.01" min="0" id="per_value"
                                       {{ 'disabled' if not user.investor_profile.has_per }}>
                                <span class="input-group-text">‚Ç¨</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Assurance Vie -->
                    <div class="patrimoine-edit-item">
                        <div class="patrimoine-checkbox">
                            <input type="checkbox" id="admin_has_life_insurance" name="has_life_insurance" 
                                   {{ 'checked' if user.investor_profile.has_life_insurance }}
                                   onchange="togglePatrimoineField('life_insurance')">
                            <label for="admin_has_life_insurance" class="patrimoine-label">
                                <i class="fas fa-shield-alt"></i>
                                Assurance Vie
                            </label>
                        </div>
                        <div class="patrimoine-value">
                            <div class="input-group">
                                <input type="number" class="form-control" name="life_insurance_value" 
                                       value="{{ user.investor_profile.life_insurance_value if user.investor_profile.has_life_insurance else 0 }}" 
                                       step="0.01" min="0" id="life_insurance_value"
                                       {{ 'disabled' if not user.investor_profile.has_life_insurance }}>
                                <span class="input-group-text">‚Ç¨</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Placements personnalis√©s -->
                    {% for placement in user.investor_profile.placements_personnalises_data %}
                    <div class="patrimoine-edit-item placement-personnalise-item">
                        <div class="patrimoine-checkbox">
                            <input type="checkbox" checked>
                            <label class="patrimoine-label">
                                <i class="fas fa-chart-area"></i>
                                {{ placement.name }}
                            </label>
                        </div>
                        <div class="patrimoine-value">
                            <div class="input-group">
                                <input type="text" class="form-control placement-name-input" name="placement_personnalise_name[]" 
                                       value="{{ placement.name }}" placeholder="Nom du placement">
                                <input type="number" class="form-control" name="placement_personnalise_amount[]" 
                                       value="{{ placement.amount }}" step="0.01" min="0">
                                <span class="input-group-text">‚Ç¨</span>
                                <button type="button" class="btn btn-danger btn-sm" onclick="removePlacementItem(this)">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    
                    <div class="patrimoine-edit-item add-placement-grid-item" id="addPlacementGridItem">
                        <div class="patrimoine-checkbox add-placement-checkbox" onclick="addPlacementInline()">
                            <div class="add-placement-content">
                                <i class="fas fa-plus"></i>
                                <span>Ajouter un placement</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Total Placements -->
                <div class="total-section">
                    <div class="total-display">
                        <i class="fas fa-chart-line"></i> <span id="totalPlacements">0‚Ç¨</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 6: CRYPTOMONNAIES -->
        <div class="platform-card mb-4" id="cryptoCard">
            <div class="platform-card-header">
                <h3 class="platform-card-title">
                    CRYPTOMONNAIES
                </h3>
                <p class="platform-card-subtitle">Portefeuille de cryptomonnaies - √Ä remplir uniquement si les cryptos sont d√©tenues en direct sur un wallet ou un compte d'exchange</p>
            </div>
            <div class="platform-card-body">
                <div class="crypto-edit-grid" id="cryptoGrid">
                    {% for crypto in user.investor_profile.cryptomonnaies_data %}
                    <div class="crypto-edit-item">
                        <div class="financial-edit-item">
                            <label class="financial-label">Cryptomonnaie</label>
                            <select class="form-control crypto-select" name="cryptomonnaie_symbol[]">
                                <option value="">Choisir une crypto...</option>
                                <option value="BTC" {{ 'selected' if crypto.symbol == 'BTC' }}>Bitcoin (BTC)</option>
                                <option value="ETH" {{ 'selected' if crypto.symbol == 'ETH' }}>Ethereum (ETH)</option>
                                <option value="BNB" {{ 'selected' if crypto.symbol == 'BNB' }}>BNB (BNB)</option>
                                <option value="XRP" {{ 'selected' if crypto.symbol == 'XRP' }}>XRP (XRP)</option>
                                <option value="ADA" {{ 'selected' if crypto.symbol == 'ADA' }}>Cardano (ADA)</option>
                                <option value="DOGE" {{ 'selected' if crypto.symbol == 'DOGE' }}>Dogecoin (DOGE)</option>
                                <option value="SOL" {{ 'selected' if crypto.symbol == 'SOL' }}>Solana (SOL)</option>
                                <option value="TRX" {{ 'selected' if crypto.symbol == 'TRX' }}>TRON (TRX)</option>
                                <option value="DOT" {{ 'selected' if crypto.symbol == 'DOT' }}>Polkadot (DOT)</option>
                                <option value="AVAX" {{ 'selected' if crypto.symbol == 'AVAX' }}>Avalanche (AVAX)</option>
                                <option value="SHIB" {{ 'selected' if crypto.symbol == 'SHIB' }}>Shiba Inu (SHIB)</option>
                                <option value="LTC" {{ 'selected' if crypto.symbol == 'LTC' }}>Litecoin (LTC)</option>
                                <option value="BCH" {{ 'selected' if crypto.symbol == 'BCH' }}>Bitcoin Cash (BCH)</option>
                                <option value="LINK" {{ 'selected' if crypto.symbol == 'LINK' }}>Chainlink (LINK)</option>
                                <option value="ATOM" {{ 'selected' if crypto.symbol == 'ATOM' }}>Cosmos (ATOM)</option>
                                <option value="XMR" {{ 'selected' if crypto.symbol == 'XMR' }}>Monero (XMR)</option>
                                <option value="UNI" {{ 'selected' if crypto.symbol == 'UNI' }}>Uniswap (UNI)</option>
                                <option value="ICP" {{ 'selected' if crypto.symbol == 'ICP' }}>Internet Computer (ICP)</option>
                                <option value="ETC" {{ 'selected' if crypto.symbol == 'ETC' }}>Ethereum Classic (ETC)</option>
                                <option value="FIL" {{ 'selected' if crypto.symbol == 'FIL' }}>Filecoin (FIL)</option>
                            </select>
                        </div>
                        <div class="financial-edit-item">
                            <label class="financial-label">Quantit√©</label>
                            <input type="number" class="form-control" name="cryptomonnaie_quantity[]" 
                                   value="{{ crypto.quantity }}" step="0.00000001" min="0">
                        </div>
                        <div class="financial-edit-item">
                            <button type="button" class="btn btn-sm btn-danger" onclick="removeCryptoItem(this)">
                                <i class="fas fa-trash"></i> Supprimer
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                    
                    <div class="patrimoine-edit-item add-crypto-grid-item" id="addCryptoGridItem">
                        <div class="patrimoine-checkbox add-crypto-checkbox" onclick="addCryptoInline()">
                            <div class="add-crypto-content">
                                <i class="fas fa-plus"></i>
                                <span>Ajouter une crypto</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Total Cryptos -->
                <div class="total-section">
                    <div class="total-display">
                        <i class="fas fa-bitcoin"></i> <span id="totalCrypto">0‚Ç¨</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Boutons d'action -->
        <div class="edit-actions">
            <a href="{{ url_for('platform_admin.user_detail', user_id=user.id) }}" class="admin-btn admin-btn-secondary">
                <i class="fas fa-times"></i>
                Annuler
            </a>
            <button type="submit" class="admin-btn admin-btn-primary">
                <i class="fas fa-save"></i>
                Sauvegarder les modifications
            </button>
        </div>
    </form>
</div>

{% else %}
<!-- MODE VISUALISATION -->
<div class="view-mode-container">
    <!-- Actions rapides -->
    <div class="admin-actions mb-4">
        <a href="{{ url_for('platform_admin.user_detail', user_id=user.id, edit='true') }}" class="admin-btn admin-btn-primary">
            <i class="fas fa-edit"></i>
            Modifier les donn√©es
        </a>
        {% if user.subscription %}
        <button class="admin-btn admin-btn-warning" onclick="manageSubscription({{ user.id }})">
            <i class="fas fa-crown"></i>
            G√©rer l'abonnement
        </button>
        {% endif %}
    </div>

    <!-- Informations utilisateur -->
    <div class="platform-card mb-4">
        <div class="platform-card-header">
            <h3 class="platform-card-title">
                <i class="fas fa-user text-primary"></i>
                Informations personnelles
            </h3>
            <p class="platform-card-subtitle">Donn√©es de base de l'utilisateur</p>
        </div>
        <div class="platform-card-body">
            <div class="user-info-grid">
                <div class="user-info-item">
                    <div class="info-label">Nom complet</div>
                    <div class="info-value">{{ user.first_name }} {{ user.last_name }}</div>
                </div>
                <div class="user-info-item">
                    <div class="info-label">Email</div>
                    <div class="info-value">{{ user.email }}</div>
                </div>
                <div class="user-info-item">
                    <div class="info-label">T√©l√©phone</div>
                    <div class="info-value">{{ user.phone or 'Non renseign√©' }}</div>
                </div>
                <div class="user-info-item">
                    <div class="info-label">Date cr√©ation</div>
                    <div class="info-value">{{ user.date_created.strftime('%d/%m/%Y √† %H:%M') if user.date_created else '-' }}</div>
                </div>
                {% if user.last_login %}
                <div class="user-info-item">
                    <div class="info-label">Derni√®re connexion</div>
                    <div class="info-value">{{ user.last_login.strftime('%d/%m/%Y √† %H:%M') }}</div>
                </div>
                {% endif %}
                <div class="user-info-item">
                    <div class="info-label">Statut</div>
                    <div class="info-value">
                        <span class="status-badge status-active">
                            Client
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Situation financi√®re -->
    <div class="platform-card mb-4">
        <div class="platform-card-header">
            <h3 class="platform-card-title">
                <i class="fas fa-euro-sign text-primary"></i>
                Situation financi√®re
            </h3>
            <p class="platform-card-subtitle">Revenus et capacit√© d'√©pargne</p>
        </div>
        <div class="platform-card-body">
            <div class="financial-view-grid">
                <div class="financial-view-item">
                    <div class="financial-label">Revenus mensuels nets</div>
                    <div class="financial-value">{{ "{:,.0f}".format(user.investor_profile.monthly_net_income) }}‚Ç¨</div>
                </div>
                <div class="financial-view-item">
                    <div class="financial-label">√âpargne actuelle</div>
                    <div class="financial-value">{{ "{:,.0f}".format(user.investor_profile.current_savings) }}‚Ç¨</div>
                </div>
                <div class="financial-view-item">
                    <div class="financial-label">Capacit√© d'√©pargne mensuelle</div>
                    <div class="financial-value">{{ "{:,.0f}".format(user.investor_profile.monthly_savings_capacity) }}‚Ç¨</div>
                </div>
                <div class="financial-view-item">
                    <div class="financial-label">Taux d'√©pargne</div>
                    <div class="financial-value">
                        {% set taux_epargne = (user.investor_profile.monthly_savings_capacity / user.investor_profile.monthly_net_income * 100) if user.investor_profile.monthly_net_income > 0 %}
                        {{ "{:.1f}".format(taux_epargne) }}%
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Section revenus compl√©mentaires -->
    {% if user.investor_profile.revenus_complementaires_data %}
    <div class="platform-card mb-4">
        <div class="platform-card-header">
            <h3 class="platform-card-title">
                <i class="fas fa-plus-circle text-success"></i>
                REVENUS COMPL√âMENTAIRES
            </h3>
            <p class="platform-card-subtitle">Sources de revenus suppl√©mentaires</p>
        </div>
        <div class="platform-card-body">
            <div class="revenue-view-grid">
                {% for revenu in user.investor_profile.revenus_complementaires_data %}
                <div class="revenue-view-item">
                    <div class="revenue-icon">
                        <i class="fas fa-coins"></i>
                    </div>
                    <div class="revenue-info">
                        <div class="revenue-name">{{ revenu.name }}</div>
                        <div class="revenue-amount">{{ "{:,.0f}".format(revenu.amount) }}‚Ç¨/mois</div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Section 3: CHARGES -->
    {% if user.investor_profile.charges_data %}
    <div class="platform-card mb-4">
        <div class="platform-card-header">
            <h3 class="platform-card-title">
                <i class="fas fa-minus-circle text-danger"></i>
                CHARGES
            </h3>
            <p class="platform-card-subtitle">Charges et d√©penses mensuelles</p>
        </div>
        <div class="platform-card-body">
            <div class="charges-view-grid">
                {% for charge in user.investor_profile.charges_data %}
                <div class="charge-view-item">
                    <div class="charge-icon">
                        <i class="fas fa-credit-card"></i>
                    </div>
                    <div class="charge-info">
                        <div class="charge-name">{{ charge.name }}</div>
                        <div class="charge-amount">{{ "{:,.0f}".format(charge.amount) }}‚Ç¨/mois</div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Section 4: LIQUIDIT√âS -->
    <div class="platform-card mb-4">
        <div class="platform-card-header">
            <h3 class="platform-card-title">
                <i class="fas fa-water text-info"></i>
                LIQUIDIT√âS
            </h3>
            <p class="platform-card-subtitle">Comptes et liquidit√©s disponibles</p>
        </div>
        <div class="platform-card-body">
            <div class="patrimoine-view-grid">
                <!-- Livret A -->
                {% if user.investor_profile.has_livret_a and user.investor_profile.livret_a_value > 0 %}
                <div class="patrimoine-view-item">
                    <div class="patrimoine-view-icon">
                        <i class="fas fa-piggy-bank"></i>
                    </div>
                    <div class="patrimoine-view-info">
                        <div class="patrimoine-view-name">Livret A</div>
                        <div class="patrimoine-view-amount">{{ "{:,.0f}".format(user.investor_profile.livret_a_value) }}‚Ç¨</div>
                    </div>
                </div>
                {% endif %}
                
                <!-- Compte Courant -->
                {% if user.investor_profile.has_current_account and user.investor_profile.current_account_value > 0 %}
                <div class="patrimoine-view-item">
                    <div class="patrimoine-view-icon">
                        <i class="fas fa-credit-card"></i>
                    </div>
                    <div class="patrimoine-view-info">
                        <div class="patrimoine-view-name">Compte courant</div>
                        <div class="patrimoine-view-amount">{{ "{:,.0f}".format(user.investor_profile.current_account_value) }}‚Ç¨</div>
                    </div>
                </div>
                {% endif %}
                
                <!-- Liquidit√©s personnalis√©es -->
                {% for liquidite in user.investor_profile.liquidites_personnalisees_data %}
                <div class="patrimoine-view-item custom">
                    <div class="patrimoine-view-icon">
                        <i class="fas fa-coins"></i>
                    </div>
                    <div class="patrimoine-view-info">
                        <div class="patrimoine-view-name">{{ liquidite.name }}</div>
                        <div class="patrimoine-view-amount">{{ "{:,.0f}".format(liquidite.amount) }}‚Ç¨</div>
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <!-- Total Liquidit√©s - Style patrimoine exact -->
            {% set total_liquidites = 0 %}
            {% if user.investor_profile.has_livret_a and user.investor_profile.livret_a_value %}
                {% set total_liquidites = total_liquidites + user.investor_profile.livret_a_value %}
            {% endif %}
            {% if user.investor_profile.has_current_account and user.investor_profile.current_account_value %}
                {% set total_liquidites = total_liquidites + user.investor_profile.current_account_value %}
            {% endif %}
            {% if user.investor_profile.has_ldds and user.investor_profile.ldds_value %}
                {% set total_liquidites = total_liquidites + user.investor_profile.ldds_value %}
            {% endif %}
            {% if user.investor_profile.has_lep and user.investor_profile.lep_value %}
                {% set total_liquidites = total_liquidites + user.investor_profile.lep_value %}
            {% endif %}
            {% if user.investor_profile.has_pel_cel and user.investor_profile.pel_cel_value %}
                {% set total_liquidites = total_liquidites + user.investor_profile.pel_cel_value %}
            {% endif %}
            {% for liquidite in user.investor_profile.liquidites_personnalisees_data %}
                {% set total_liquidites = total_liquidites + liquidite.amount %}
            {% endfor %}
            
            {% if total_liquidites > 0 %}
            <div class="total-section-view">
                <div class="total-display-view liquidites">
                    <i class="fas fa-coins"></i> 
                    <span>Total Liquidit√©s: {{ "{:,.0f}".format(total_liquidites) }}‚Ç¨</span>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Section 5: PLACEMENTS FINANCIERS -->
    <div class="platform-card mb-4">
        <div class="platform-card-header">
            <h3 class="platform-card-title">
                <i class="fas fa-chart-line text-success"></i>
                PLACEMENTS FINANCIERS
            </h3>
            <p class="platform-card-subtitle">Investissements et placements</p>
        </div>
        <div class="platform-card-body">
            <div class="patrimoine-view-grid">
                <!-- PEA -->
                {% if user.investor_profile.has_pea and user.investor_profile.pea_value > 0 %}
                <div class="patrimoine-view-item">
                    <div class="patrimoine-view-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="patrimoine-view-info">
                        <div class="patrimoine-view-name">PEA</div>
                        <div class="patrimoine-view-amount">{{ "{:,.0f}".format(user.investor_profile.pea_value) }}‚Ç¨</div>
                    </div>
                </div>
                {% endif %}
                
                <!-- PER -->
                {% if user.investor_profile.has_per and user.investor_profile.per_value > 0 %}
                <div class="patrimoine-view-item">
                    <div class="patrimoine-view-icon">
                        <i class="fas fa-university"></i>
                    </div>
                    <div class="patrimoine-view-info">
                        <div class="patrimoine-view-name">PER</div>
                        <div class="patrimoine-view-amount">{{ "{:,.0f}".format(user.investor_profile.per_value) }}‚Ç¨</div>
                    </div>
                </div>
                {% endif %}
                
                <!-- Assurance Vie -->
                {% if user.investor_profile.has_life_insurance and user.investor_profile.life_insurance_value > 0 %}
                <div class="patrimoine-view-item">
                    <div class="patrimoine-view-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div class="patrimoine-view-info">
                        <div class="patrimoine-view-name">Assurance Vie</div>
                        <div class="patrimoine-view-amount">{{ "{:,.0f}".format(user.investor_profile.life_insurance_value) }}‚Ç¨</div>
                    </div>
                </div>
                {% endif %}
                
                <!-- Placements personnalis√©s -->
                {% for placement in user.investor_profile.placements_personnalises_data %}
                <div class="patrimoine-view-item custom">
                    <div class="patrimoine-view-icon">
                        <i class="fas fa-chart-area"></i>
                    </div>
                    <div class="patrimoine-view-info">
                        <div class="patrimoine-view-name">{{ placement.name }}</div>
                        <div class="patrimoine-view-amount">{{ "{:,.0f}".format(placement.amount) }}‚Ç¨</div>
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <!-- Total Placements - Calcul complet -->
            {% set total_placements = 0 %}
            {% if user.investor_profile.has_pea and user.investor_profile.pea_value %}
                {% set total_placements = total_placements + user.investor_profile.pea_value %}
            {% endif %}
            {% if user.investor_profile.has_per and user.investor_profile.per_value %}
                {% set total_placements = total_placements + user.investor_profile.per_value %}
            {% endif %}
            {% if user.investor_profile.has_life_insurance and user.investor_profile.life_insurance_value %}
                {% set total_placements = total_placements + user.investor_profile.life_insurance_value %}
            {% endif %}
            {% if user.investor_profile.has_pee and user.investor_profile.pee_value %}
                {% set total_placements = total_placements + user.investor_profile.pee_value %}
            {% endif %}
            {% if user.investor_profile.has_scpi and user.investor_profile.scpi_value %}
                {% set total_placements = total_placements + user.investor_profile.scpi_value %}
            {% endif %}
            {% for placement in user.investor_profile.placements_personnalises_data %}
                {% set total_placements = total_placements + placement.amount %}
            {% endfor %}
            
            <!-- Calcul du patrimoine total en temps r√©el -->
            {% set patrimoine_total = total_liquidites + total_placements %}
            
            {% if total_placements > 0 %}
            <div class="total-section-view">
                <div class="total-display-view placements">
                    <i class="fas fa-chart-line"></i> 
                    <span>Total Placements: {{ "{:,.0f}".format(total_placements) }}‚Ç¨</span>
                </div>
            </div>
            {% endif %}
            
            <!-- Patrimoine total -->
            {% if patrimoine_total > 0 %}
            <div class="total-section-view mt-3">
                <div class="total-display-view patrimoine-total">
                    <i class="fas fa-coins"></i> 
                    <span>PATRIMOINE TOTAL: {{ "{:,.0f}".format(patrimoine_total) }}‚Ç¨</span>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Section 6: CRYPTOMONNAIES -->
    {% if user.investor_profile.cryptomonnaies_data %}
    <div class="platform-card mb-4">
        <div class="platform-card-header">
            <h3 class="platform-card-title">
                <i class="fab fa-bitcoin text-warning"></i>
                CRYPTOMONNAIES
            </h3>
            <p class="platform-card-subtitle">Portefeuille de cryptomonnaies d√©tenues en direct</p>
        </div>
        <div class="platform-card-body">
            <div class="crypto-view-grid">
                {% for crypto in user.investor_profile.cryptomonnaies_data %}
                <div class="crypto-view-item">
                    <div class="crypto-view-icon">
                        <i class="fab fa-bitcoin"></i>
                    </div>
                    <div class="crypto-view-info">
                        <div class="crypto-view-name">{{ crypto.symbol }}</div>
                        <div class="crypto-view-quantity">{{ crypto.quantity }}</div>
                        <div class="crypto-view-note">Valeur temps r√©el √† calculer</div>
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <div class="total-section-view">
                <div class="total-display-view crypto">
                    <i class="fab fa-bitcoin"></i> 
                    <span>Valeur totale: Calcul en temps r√©el requis</span>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Section 7: PROFIL INVESTISSEUR -->
    <div class="platform-card mb-4">
        <div class="platform-card-header">
            <h3 class="platform-card-title">
                <i class="fas fa-chart-bar text-primary"></i>
                PROFIL INVESTISSEUR
            </h3>
            <p class="platform-card-subtitle">Profil et objectifs d'investissement</p>
        </div>
        <div class="platform-card-body">
            <div class="view-data-grid">
                <div class="view-data-item">
                    <div class="view-label">Revenus mensuels nets</div>
                    <div class="view-value amount">{{ "{:,.0f}".format(user.investor_profile.monthly_net_income) }}‚Ç¨</div>
                </div>
                <div class="view-data-item">
                    <div class="view-label">√âpargne actuelle</div>
                    <div class="view-value amount">{{ "{:,.0f}".format(user.investor_profile.current_savings) }}‚Ç¨</div>
                </div>
                <div class="view-data-item">
                    <div class="view-label">Capacit√© d'√©pargne mensuelle</div>
                    <div class="view-value amount">{{ "{:,.0f}".format(user.investor_profile.monthly_savings_capacity) }}‚Ç¨</div>
                </div>
                <div class="view-data-item">
                    <div class="view-label">Situation familiale</div>
                    <div class="view-value">{{ user.investor_profile.family_situation|title if user.investor_profile.family_situation else '-' }}</div>
                </div>
                <div class="view-data-item">
                    <div class="view-label">Tol√©rance au risque</div>
                    <div class="view-value risk-{{ user.investor_profile.risk_tolerance|lower if user.investor_profile.risk_tolerance }}">
                        {{ user.investor_profile.risk_tolerance|title if user.investor_profile.risk_tolerance else '-' }}
                    </div>
                </div>
                <div class="view-data-item">
                    <div class="view-label">Exp√©rience d'investissement</div>
                    <div class="view-value">{{ user.investor_profile.investment_experience|title if user.investor_profile.investment_experience else '-' }}</div>
                </div>
                <div class="view-data-item">
                    <div class="view-label">Horizon d'investissement</div>
                    <div class="view-value">{{ user.investor_profile.investment_horizon|title if user.investor_profile.investment_horizon else '-' }}</div>
                </div>
                <div class="view-data-item">
                    <div class="view-label">Situation professionnelle</div>
                    <div class="view-value">{{ user.investor_profile.professional_situation|title if user.investor_profile.professional_situation else '-' }}</div>
                </div>
            </div>
            
            {% if user.investor_profile.investment_goals %}
            <div class="objectives-content">
                <h4 class="objectives-title">Objectifs d'investissement</h4>
                <div class="objectives-text">
                    {{ user.investor_profile.investment_goals|replace('\n', '<br>')|safe }}
                </div>
            </div>
            {% endif %}
        </div>
    </div>

</div>
{% endif %}

{% else %}
<!-- Utilisateur sans profil investisseur -->
<div class="platform-card">
    <div class="platform-card-body text-center">
        <i class="fas fa-user-slash text-muted" style="font-size: 48px; margin-bottom: 16px;"></i>
        <h4>Profil investisseur non compl√©t√©</h4>
        <p class="text-muted">Cet utilisateur n'a pas encore compl√©t√© son profil investisseur.</p>
    </div>
</div>
{% endif %}

<!-- Import des styles de la page profil -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/investor_data.css') }}">
<style>
/* Styles Atlas pour la grille de patrimoine */
.liquidites-edit-grid, .placements-edit-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
    margin-bottom: 24px;
}

.patrimoine-edit-item {
    background: var(--qlower-white);
    border: 2px solid var(--qlower-border);
    border-radius: 16px;
    padding: 20px;
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.patrimoine-edit-item:hover {
    border-color: var(--qlower-primary);
    transform: translateY(-2px);
    box-shadow: 0 4px 20px rgba(19, 124, 139, 0.1);
}

.patrimoine-checkbox {
    display: flex;
    align-items: center;
    gap: 12px;
}

.patrimoine-checkbox input[type="checkbox"] {
    width: 20px;
    height: 20px;
    accent-color: var(--qlower-primary);
    cursor: pointer;
}

.patrimoine-label {
    display: flex;
    align-items: center;
    gap: 12px;
    font-weight: 600;
    color: var(--qlower-dark);
    font-size: 16px;
    cursor: pointer;
    margin: 0;
}

.patrimoine-label i {
    font-size: 20px;
    width: 24px;
    text-align: center;
    color: var(--qlower-primary);
}

.patrimoine-value {
    margin-top: 8px;
}

/* Boutons d'ajout int√©gr√©s dans la grille */
.add-liquidite-grid-item, .add-placement-grid-item, .add-crypto-grid-item {
    border: 2px dashed var(--qlower-primary) !important;
    background: linear-gradient(135deg, var(--qlower-primary) 0%, var(--qlower-light) 100%) !important;
    transition: all 0.3s ease;
    cursor: pointer;
    min-height: 120px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.add-liquidite-grid-item:hover, .add-placement-grid-item:hover, .add-crypto-grid-item:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 25px rgba(19, 124, 139, 0.15);
}

.add-liquidite-checkbox, .add-placement-checkbox, .add-crypto-checkbox {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 14px;
}

.add-liquidite-content, .add-placement-content, .add-crypto-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    color: white;
    font-weight: 600;
}

.add-liquidite-content i, .add-placement-content i, .add-crypto-content i {
    font-size: 24px;
}

/* Section totaux */
.total-section {
    margin-top: 24px;
    padding-top: 20px;
    border-top: 2px solid var(--qlower-border);
}

.total-display {
    background: linear-gradient(135deg, var(--qlower-primary) 0%, var(--qlower-light) 100%);
    color: white;
    padding: 16px 24px;
    border-radius: 12px;
    font-size: 18px;
    font-weight: bold;
    text-align: center;
    font-family: 'Encode Sans Condensed', 'Inter', sans-serif;
}

.total-display i {
    margin-right: 8px;
    font-size: 20px;
}

/* Styles pour les √©l√©ments personnalis√©s */
.liquidite-personnalisee-item, .placement-personnalise-item {
    border-color: var(--qlower-primary) !important;
    background: linear-gradient(135deg, rgba(19, 124, 139, 0.05) 0%, rgba(112, 156, 167, 0.05) 100%);
}

.liquidite-name-input, .placement-name-input {
    border-right: none !important;
    border-top-right-radius: 0 !important;
    border-bottom-right-radius: 0 !important;
}

/* Crypto section styles */
.crypto-edit-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 20px;
    margin-bottom: 24px;
}

.crypto-edit-item {
    background: var(--qlower-bg-light);
    border: 2px solid var(--qlower-border);
    border-radius: 16px;
    padding: 20px;
    transition: all 0.3s ease;
    display: grid;
    grid-template-columns: 2fr 1fr auto;
    gap: 16px;
    align-items: end;
}

.crypto-edit-item:hover {
    border-color: var(--qlower-primary);
    transform: translateY(-2px);
    box-shadow: 0 4px 20px rgba(19, 124, 139, 0.1);
}

.crypto-select {
    font-size: 14px;
}

/* Styles g√©n√©raux */
.financial-edit-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 24px;
    margin-bottom: 24px;
}

.financial-edit-item {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.financial-label {
    font-weight: 600;
    color: var(--qlower-dark);
    font-size: 14px;
    margin-bottom: 8px;
    display: block;
}

.form-control {
    display: block;
    width: 100%;
    padding: 12px 16px;
    font-size: 14px;
    font-weight: 400;
    line-height: 1.5;
    color: var(--qlower-dark);
    background-color: var(--qlower-white);
    background-clip: padding-box;
    border: 2px solid var(--qlower-border);
    border-radius: 12px;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
    font-family: 'Inter', sans-serif;
}

.form-control:focus {
    color: var(--qlower-dark);
    background-color: var(--qlower-white);
    border-color: var(--qlower-primary);
    outline: 0;
    box-shadow: 0 0 0 3px rgba(19, 124, 139, 0.1);
}

.input-group {
    position: relative;
    display: flex;
    flex-wrap: wrap;
    align-items: stretch;
    width: 100%;
}

.input-group .form-control {
    position: relative;
    flex: 1 1 auto;
    width: 1%;
    min-width: 0;
    margin-bottom: 0;
    border-top-right-radius: 0;
    border-bottom-right-radius: 0;
    border-right: none;
}

.input-group-text {
    display: flex;
    align-items: center;
    padding: 12px 16px;
    font-size: 14px;
    font-weight: 500;
    line-height: 1.5;
    color: var(--qlower-dark);
    text-align: center;
    white-space: nowrap;
    background-color: var(--qlower-bg-light);
    border: 2px solid var(--qlower-border);
    border-left: none;
    border-radius: 0 12px 12px 0;
    font-family: 'Inter', sans-serif;
}

.platform-card {
    background: var(--qlower-white);
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    border: 1px solid var(--qlower-border);
    overflow: hidden;
    margin-bottom: 24px;
}

.platform-card-header {
    padding: 24px 24px 0;
    border-bottom: 1px solid var(--qlower-border);
    margin-bottom: 24px;
}

.platform-card-title {
    font-size: 20px;
    font-weight: 700;
    color: var(--qlower-dark);
    margin: 0 0 8px 0;
    display: flex;
    align-items: center;
    gap: 12px;
}

.platform-card-subtitle {
    font-size: 14px;
    color: var(--qlower-text-light);
    margin: 0 0 24px 0;
}

.platform-card-body {
    padding: 0 24px 24px;
}

.edit-actions {
    display: flex;
    gap: 16px;
    justify-content: flex-end;
    padding: 32px 0;
    border-top: 2px solid var(--qlower-border);
    margin-top: 32px;
}

.alert {
    padding: 16px 20px;
    margin-bottom: 24px;
    border: 1px solid transparent;
    border-radius: 12px;
    display: flex;
    align-items: center;
    gap: 12px;
}

.alert-warning {
    color: #856404;
    background-color: #fff3cd;
    border-color: #ffeaa7;
}

/* Page title responsive */
.page-title-responsive {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 16px;
}

@media (max-width: 768px) {
    .page-title-responsive {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .liquidites-edit-grid, .placements-edit-grid {
        grid-template-columns: 1fr;
    }
    
    .financial-edit-grid {
        grid-template-columns: 1fr;
    }
    
    .crypto-edit-grid {
        grid-template-columns: 1fr;
    }
    
    .crypto-edit-item {
        grid-template-columns: 1fr;
        gap: 12px;
    }
    
    .edit-actions {
        flex-direction: column;
        gap: 12px;
    }
}

/* Styles exactement copi√©s depuis prospect_detail.html */
.user-info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
}

.user-info-item {
    display: flex;
    flex-direction: column;
    gap: 8px;
    padding: 16px;
    background: var(--qlower-bg-light);
    border-radius: 8px;
}

.info-label {
    font-weight: 500;
    color: var(--qlower-text-light);
    font-size: 14px;
}

.info-value {
    font-weight: 600;
    color: var(--qlower-dark);
    font-size: 16px;
}

.status-badge {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
}

.status-active {
    background: #d4edda;
    color: #155724;
}

.status-inactive {
    background: #f8d7da;
    color: #721c24;
}

/* Styles sp√©cifiques pour le mode visualisation */
.financial-view-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
}

.financial-view-item {
    display: flex;
    flex-direction: column;
    gap: 8px;
    padding: 20px;
    background: var(--qlower-bg-light);
    border-radius: 12px;
    border: 1px solid var(--qlower-border);
}

.financial-label {
    font-weight: 500;
    color: var(--qlower-text-light);
    font-size: 14px;
    margin-bottom: 4px;
}

.financial-value {
    font-weight: 700;
    color: var(--qlower-dark);
    font-size: 20px;
    font-family: 'Encode Sans Condensed', 'Inter', sans-serif;
}

/* Styles pour les sections de revenus et charges */
.revenue-view-grid, .charges-view-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 16px;
    margin-bottom: 24px;
}

.revenue-view-item, .charge-view-item {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 20px;
    background: var(--qlower-white);
    border: 2px solid var(--qlower-border);
    border-radius: 12px;
    transition: all 0.3s ease;
}

.revenue-view-item:hover, .charge-view-item:hover {
    border-color: var(--qlower-primary);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(19, 124, 139, 0.1);
}

.revenue-icon, .charge-icon {
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--qlower-primary) 0%, var(--qlower-light) 100%);
    color: white;
    font-size: 20px;
    flex-shrink: 0;
}

.charge-icon {
    background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
}

.revenue-info, .charge-info {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.revenue-name, .charge-name {
    font-weight: 600;
    color: var(--qlower-dark);
    font-size: 16px;
}

.revenue-amount {
    font-family: 'Encode Sans Condensed', 'Inter', sans-serif;
    font-weight: 700;
    color: #28a745;
    font-size: 18px;
}

.charge-amount {
    font-family: 'Encode Sans Condensed', 'Inter', sans-serif;
    font-weight: 700;
    color: #dc3545;
    font-size: 18px;
}

/* Styles pour le patrimoine en mode lecture */
.patrimoine-view-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 16px;
    margin-bottom: 24px;
}

.patrimoine-view-item {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 20px;
    background: var(--qlower-white);
    border: 2px solid var(--qlower-border);
    border-radius: 12px;
    transition: all 0.3s ease;
}

.patrimoine-view-item:hover {
    border-color: var(--qlower-primary);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(19, 124, 139, 0.1);
}

.patrimoine-view-item.custom {
    border-color: var(--qlower-primary);
    background: linear-gradient(135deg, rgba(19, 124, 139, 0.05) 0%, rgba(112, 156, 167, 0.05) 100%);
}

.patrimoine-view-icon {
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--qlower-primary) 0%, var(--qlower-light) 100%);
    color: white;
    font-size: 20px;
    flex-shrink: 0;
}

.patrimoine-view-info {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.patrimoine-view-name {
    font-weight: 600;
    color: var(--qlower-dark);
    font-size: 16px;
}

.patrimoine-view-amount {
    font-family: 'Encode Sans Condensed', 'Inter', sans-serif;
    font-weight: 700;
    color: var(--qlower-primary);
    font-size: 18px;
}

/* Styles pour les cryptos en mode lecture */
.crypto-view-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 16px;
    margin-bottom: 24px;
}

.crypto-view-item {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 20px;
    background: var(--qlower-white);
    border: 2px solid var(--qlower-border);
    border-radius: 12px;
    transition: all 0.3s ease;
}

.crypto-view-item:hover {
    border-color: #f7931a;
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(247, 147, 26, 0.1);
}

.crypto-view-icon {
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    background: linear-gradient(135deg, #f7931a 0%, #ff9500 100%);
    color: white;
    font-size: 20px;
    flex-shrink: 0;
}

.crypto-view-info {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.crypto-view-name {
    font-weight: 700;
    color: var(--qlower-dark);
    font-size: 16px;
    font-family: 'Encode Sans Condensed', sans-serif;
}

.crypto-view-quantity {
    font-family: 'Encode Sans Condensed', 'Inter', sans-serif;
    font-weight: 600;
    color: #f7931a;
    font-size: 18px;
}

.crypto-view-note {
    font-size: 12px;
    color: var(--qlower-text-light);
    font-style: italic;
}

/* Styles pour les totaux en mode lecture */
.total-section-view {
    margin-top: 24px;
    padding-top: 20px;
    border-top: 2px solid var(--qlower-border);
}

.total-display-view {
    color: white;
    padding: 16px 24px;
    border-radius: 12px;
    font-size: 18px;
    font-weight: bold;
    text-align: center;
    font-family: 'Encode Sans Condensed', 'Inter', sans-serif;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.total-display-view.liquidites {
    background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
}

.total-display-view.placements {
    background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
}

.total-display-view.crypto {
    background: linear-gradient(135deg, #f7931a 0%, #ff9500 100%);
}

.total-display-view.patrimoine-total {
    background: linear-gradient(135deg, #6f42c1 0%, #5a2d91 100%);
    font-size: 22px;
    font-weight: 800;
    border: 3px solid #6f42c1;
    box-shadow: 0 6px 25px rgba(111, 66, 193, 0.2);
}

.total-display-view i {
    font-size: 20px;
}

/* Objectives - copi√©s depuis prospect_detail.html */
.objectives-content {
    margin-top: 0;
}

.objectives-text {
    background: var(--qlower-bg-light);
    padding: 20px;
    border-radius: 12px;
    border: 1px solid var(--qlower-border);
    color: var(--qlower-dark);
    font-size: 15px;
    line-height: 1.6;
}

/* Styles pour la tol√©rance au risque */
.view-value.risk-conservateur {
    color: #28a745;
    background: rgba(40, 167, 69, 0.1);
    padding: 8px 16px;
    border-radius: 20px;
    display: inline-block;
}

.view-value.risk-mod√©r√© {
    color: #ffc107;
    background: rgba(255, 193, 7, 0.1);
    padding: 8px 16px;
    border-radius: 20px;
    display: inline-block;
}

.view-value.risk-dynamique {
    color: #dc3545;
    background: rgba(220, 53, 69, 0.1);
    padding: 8px 16px;
    border-radius: 20px;
    display: inline-block;
}

/* Actions admin en mode lecture */
.admin-actions {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    margin-bottom: 24px;
}

/* Responsive pour le mode lecture */
@media (max-width: 768px) {
    .view-data-grid {
        grid-template-columns: 1fr;
    }
    
    .revenue-view-grid, .charges-view-grid, 
    .patrimoine-view-grid, .crypto-view-grid {
        grid-template-columns: 1fr;
    }
    
    .admin-actions {
        flex-direction: column;
    }
}
</style>
{% endblock %}

{% block scripts %}
<script>
// Variables globales pour g√©rer les IDs uniques
let liquiditeCounter = 1000;
let placementCounter = 1000;
let cryptoCounter = 1000;

// Fonction pour ajouter une liquidit√© personnalis√©e
function addLiquiditeInline() {
    const grid = document.getElementById('liquiditesGrid');
    const addButton = document.getElementById('addLiquiditeGridItem');
    
    const newItem = document.createElement('div');
    newItem.className = 'patrimoine-edit-item liquidite-personnalisee-item';
    newItem.innerHTML = `
        <div class="patrimoine-checkbox">
            <input type="checkbox" checked>
            <label class="patrimoine-label">
                <i class="fas fa-coins"></i>
                Nouvelle liquidit√©
            </label>
        </div>
        <div class="patrimoine-value">
            <div class="input-group">
                <input type="text" class="form-control liquidite-name-input" name="liquidite_personnalisee_name[]" 
                       value="" placeholder="Nom de la liquidit√©" onchange="updateLiquiditeLabel(this)">
                <input type="number" class="form-control" name="liquidite_personnalisee_amount[]" 
                       value="0" step="0.01" min="0" onchange="calculateTotalLiquidites()">
                <span class="input-group-text">‚Ç¨</span>
                <button type="button" class="btn btn-danger btn-sm" onclick="removeLiquiditeItem(this)">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
    `;
    
    grid.insertBefore(newItem, addButton);
    calculateTotalLiquidites();
    
    // Focus sur le champ nom
    newItem.querySelector('.liquidite-name-input').focus();
}

// Fonction pour supprimer une liquidit√©
function removeLiquiditeItem(button) {
    button.closest('.patrimoine-edit-item').remove();
    calculateTotalLiquidites();
}

// Fonction pour mettre √† jour le label de la liquidit√©
function updateLiquiditeLabel(input) {
    const label = input.closest('.patrimoine-edit-item').querySelector('.patrimoine-label');
    if (input.value.trim()) {
        label.innerHTML = `<i class="fas fa-coins"></i>${input.value}`;
    } else {
        label.innerHTML = `<i class="fas fa-coins"></i>Nouvelle liquidit√©`;
    }
}

// Fonction pour ajouter un placement personnalis√©
function addPlacementInline() {
    const grid = document.getElementById('placementsGrid');
    const addButton = document.getElementById('addPlacementGridItem');
    
    const newItem = document.createElement('div');
    newItem.className = 'patrimoine-edit-item placement-personnalise-item';
    newItem.innerHTML = `
        <div class="patrimoine-checkbox">
            <input type="checkbox" checked>
            <label class="patrimoine-label">
                <i class="fas fa-chart-area"></i>
                Nouveau placement
            </label>
        </div>
        <div class="patrimoine-value">
            <div class="input-group">
                <input type="text" class="form-control placement-name-input" name="placement_personnalise_name[]" 
                       value="" placeholder="Nom du placement" onchange="updatePlacementLabel(this)">
                <input type="number" class="form-control" name="placement_personnalise_amount[]" 
                       value="0" step="0.01" min="0" onchange="calculateTotalPlacements()">
                <span class="input-group-text">‚Ç¨</span>
                <button type="button" class="btn btn-danger btn-sm" onclick="removePlacementItem(this)">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
    `;
    
    grid.insertBefore(newItem, addButton);
    calculateTotalPlacements();
    
    // Focus sur le champ nom
    newItem.querySelector('.placement-name-input').focus();
}

// Fonction pour supprimer un placement
function removePlacementItem(button) {
    button.closest('.patrimoine-edit-item').remove();
    calculateTotalPlacements();
}

// Fonction pour mettre √† jour le label du placement
function updatePlacementLabel(input) {
    const label = input.closest('.patrimoine-edit-item').querySelector('.patrimoine-label');
    if (input.value.trim()) {
        label.innerHTML = `<i class="fas fa-chart-area"></i>${input.value}`;
    } else {
        label.innerHTML = `<i class="fas fa-chart-area"></i>Nouveau placement`;
    }
}

// Fonction pour ajouter une crypto
function addCryptoInline() {
    const grid = document.getElementById('cryptoGrid');
    const addButton = document.getElementById('addCryptoGridItem');
    
    const newItem = document.createElement('div');
    newItem.className = 'crypto-edit-item';
    newItem.innerHTML = `
        <div class="financial-edit-item">
            <label class="financial-label">Cryptomonnaie</label>
            <select class="form-control crypto-select" name="cryptomonnaie_symbol[]" onchange="calculateTotalCrypto()">
                <option value="">Choisir une crypto...</option>
                <option value="BTC">Bitcoin (BTC)</option>
                <option value="ETH">Ethereum (ETH)</option>
                <option value="BNB">BNB (BNB)</option>
                <option value="XRP">XRP (XRP)</option>
                <option value="ADA">Cardano (ADA)</option>
                <option value="DOGE">Dogecoin (DOGE)</option>
                <option value="SOL">Solana (SOL)</option>
                <option value="TRX">TRON (TRX)</option>
                <option value="DOT">Polkadot (DOT)</option>
                <option value="AVAX">Avalanche (AVAX)</option>
                <option value="SHIB">Shiba Inu (SHIB)</option>
                <option value="LTC">Litecoin (LTC)</option>
                <option value="BCH">Bitcoin Cash (BCH)</option>
                <option value="LINK">Chainlink (LINK)</option>
                <option value="ATOM">Cosmos (ATOM)</option>
                <option value="XMR">Monero (XMR)</option>
                <option value="UNI">Uniswap (UNI)</option>
                <option value="ICP">Internet Computer (ICP)</option>
                <option value="ETC">Ethereum Classic (ETC)</option>
                <option value="FIL">Filecoin (FIL)</option>
            </select>
        </div>
        <div class="financial-edit-item">
            <label class="financial-label">Quantit√©</label>
            <input type="number" class="form-control" name="cryptomonnaie_quantity[]" 
                   value="0" step="0.00000001" min="0" onchange="calculateTotalCrypto()">
        </div>
        <div class="financial-edit-item">
            <button type="button" class="btn btn-sm btn-danger" onclick="removeCryptoItem(this)">
                <i class="fas fa-trash"></i> Supprimer
            </button>
        </div>
    `;
    
    grid.insertBefore(newItem, addButton);
    
    // Focus sur le select
    newItem.querySelector('.crypto-select').focus();
}

// Fonction pour supprimer une crypto
function removeCryptoItem(button) {
    button.closest('.crypto-edit-item').remove();
    calculateTotalCrypto();
}

// Fonction pour activer/d√©sactiver un champ de patrimoine
function togglePatrimoineField(fieldName) {
    const checkbox = document.getElementById(`admin_has_${fieldName}`);
    const input = document.getElementById(`${fieldName}_value`);
    
    if (checkbox.checked) {
        input.disabled = false;
        input.focus();
    } else {
        input.disabled = true;
        input.value = 0;
    }
    
    calculateTotalLiquidites();
    calculateTotalPlacements();
}

// Fonction pour calculer le total des liquidit√©s
function calculateTotalLiquidites() {
    let total = 0;
    
    // Livret A
    const livretA = document.getElementById('admin_has_livret_a');
    if (livretA && livretA.checked) {
        const value = parseFloat(document.getElementById('livret_a_value').value || 0);
        total += value;
    }
    
    // Compte courant
    const compteCourant = document.getElementById('admin_has_current_account');
    if (compteCourant && compteCourant.checked) {
        const value = parseFloat(document.getElementById('current_account_value').value || 0);
        total += value;
    }
    
    // Liquidit√©s personnalis√©es
    const liquiditesPersonnalisees = document.querySelectorAll('input[name="liquidite_personnalisee_amount[]"]');
    liquiditesPersonnalisees.forEach(input => {
        const value = parseFloat(input.value || 0);
        total += value;
    });
    
    document.getElementById('totalLiquidites').textContent = `${total.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ' ')}‚Ç¨`;
}

// Fonction pour calculer le total des placements
function calculateTotalPlacements() {
    let total = 0;
    
    // PEA
    const pea = document.getElementById('admin_has_pea');
    if (pea && pea.checked) {
        const value = parseFloat(document.getElementById('pea_value').value || 0);
        total += value;
    }
    
    // PER
    const per = document.getElementById('admin_has_per');
    if (per && per.checked) {
        const value = parseFloat(document.getElementById('per_value').value || 0);
        total += value;
    }
    
    // Assurance Vie
    const assuranceVie = document.getElementById('admin_has_life_insurance');
    if (assuranceVie && assuranceVie.checked) {
        const value = parseFloat(document.getElementById('life_insurance_value').value || 0);
        total += value;
    }
    
    // Placements personnalis√©s
    const placementsPersonnalises = document.querySelectorAll('input[name="placement_personnalise_amount[]"]');
    placementsPersonnalises.forEach(input => {
        const value = parseFloat(input.value || 0);
        total += value;
    });
    
    document.getElementById('totalPlacements').textContent = `${total.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ' ')}‚Ç¨`;
}

// Fonction pour calculer le total des cryptos (approximatif)
function calculateTotalCrypto() {
    // Pour le moment, affichage approximatif
    // Dans une vraie app, il faudrait r√©cup√©rer les prix via API
    const quantities = document.querySelectorAll('input[name="cryptomonnaie_quantity[]"]');
    let hasValue = false;
    quantities.forEach(input => {
        if (parseFloat(input.value || 0) > 0) {
            hasValue = true;
        }
    });
    
    if (hasValue) {
        document.getElementById('totalCrypto').textContent = 'Calcul en cours...';
    } else {
        document.getElementById('totalCrypto').textContent = '0‚Ç¨';
    }
}

// Initialisation au chargement de la page
document.addEventListener('DOMContentLoaded', function() {
    // Calculer les totaux initiaux
    calculateTotalLiquidites();
    calculateTotalPlacements();
    calculateTotalCrypto();
    
    // Ajouter des √©v√©nements sur tous les champs de montant
    document.querySelectorAll('input[type="number"]').forEach(input => {
        input.addEventListener('change', function() {
            if (this.name.includes('liquidite') || this.name.includes('livret_a') || this.name.includes('current_account')) {
                calculateTotalLiquidites();
            }
            if (this.name.includes('placement') || this.name.includes('pea') || this.name.includes('per') || this.name.includes('life_insurance')) {
                calculateTotalPlacements();
            }
            if (this.name.includes('cryptomonnaie_quantity')) {
                calculateTotalCrypto();
            }
        });
    });
    
    // Gestion de la soumission du formulaire
    const form = document.getElementById('adminEditFormExtended');
    if (form) {
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            console.log('Formulaire soumis - √† impl√©menter');
            alert('Sauvegarde √† impl√©menter');
        });
    }
});
</script>
{% endblock %}