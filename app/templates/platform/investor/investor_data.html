{% extends "platform/base.html" %}

{% block title %}Donn√©es investisseur - Atlas{% endblock %}

{% block page_title %}Donn√©es investisseur{% endblock %}

{% block content %}
<style>
/* DESIGN ULTRA MODERNE ALIGN√â ATLAS */
:root {
    --qlower-primary: #137C8B;
    --qlower-dark: #344D59;
    --qlower-light: #709CA7;
    --qlower-tertiary-color: #B8CBD0;
    --qlower-quaternary-color: #7A90A4;
    --qlower-bg-light: #f8f9fa;
    --qlower-text-dark: #344D59;
    --qlower-text-light: #7A90A4;
    --qlower-border: #e5e7eb;
    --qlower-white: #ffffff;
}

.investor-dashboard {
    max-width: 1200px;
    margin: 0 auto;
    padding: 24px;
    background: var(--qlower-bg-light);
    min-height: 100vh;
}

/* CARTES STYLE ATLAS MODERNE */
.platform-card {
    background: var(--qlower-white);
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    border: 1px solid var(--qlower-border);
    margin-bottom: 24px;
    overflow: hidden;
    transition: all 0.3s ease;
}

.platform-card:hover {
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
    transform: translateY(-2px);
}

.platform-card-header {
    background: linear-gradient(135deg, var(--qlower-primary) 0%, var(--qlower-light) 100%);
    color: white !important;
    padding: 20px 24px;
    display: flex;
    align-items: center;
    gap: 12px;
    position: relative;
    overflow: hidden;
}

.platform-card-header *,
.platform-card-header .platform-card-title,
.platform-card-header .platform-card-subtitle,
.platform-card-header h1,
.platform-card-header h2,
.platform-card-header h3,
.platform-card-header h4,
.platform-card-header h5,
.platform-card-header h6,
.platform-card-header p,
.platform-card-header span,
.platform-card-header div {
    color: white !important;
}

.platform-card-header::before {
    content: '';
    position: absolute;
    top: 0;
    right: -100px;
    width: 100px;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
    transform: skewX(-20deg);
    animation: shimmer 3s infinite;
}

@keyframes shimmer {
    0% { right: -100px; }
    100% { right: calc(100% + 100px); }
}


.platform-card-title {
    font-size: 20px;
    font-weight: 700;
    margin: 0;
    font-family: 'Inter', sans-serif;
    text-shadow: 0 1px 2px rgba(0,0,0,0.1);
}

.platform-card-subtitle {
    font-size: 13px;
    opacity: 0.9;
    margin: 4px 0 0 0;
    font-weight: 400;
}

.platform-card-body {
    padding: 16px 24px 24px 24px;
}

/* STYLE DES DONN√âES - UNE PAR LIGNE */
.data-list {
    list-style: none;
    margin: 0;
    padding: 0;
}

.data-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 0;
    border-bottom: 1px solid var(--qlower-border);
}

.data-item:last-child {
    border-bottom: none;
}

.data-label {
    font-size: 15px;
    font-weight: 500;
    color: var(--qlower-text-dark);
    flex: 1;
}


.data-value {
    font-size: 15px;
    font-weight: 600;
    color: var(--qlower-primary);
    text-align: right;
    min-width: 120px;
}

.data-value.financial {
    color: var(--qlower-primary);
    font-weight: 700;
}

.data-value.positive {
    color: #10b981;
}

.data-value.negative {
    color: #ef4444;
}

/* BADGES OBJECTIFS MODERNES */
.objectives-container {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.objective-badge {
    background: linear-gradient(135deg, rgba(19, 124, 139, 0.05) 0%, rgba(112, 156, 167, 0.05) 100%);
    border: 1px solid rgba(19, 124, 139, 0.2);
    border-radius: 20px;
    padding: 8px 16px;
    font-size: 13px;
    font-weight: 500;
    color: var(--qlower-primary);
    position: relative;
    overflow: hidden;
    transition: all 0.2s ease;
}

.objective-badge:hover {
    background: linear-gradient(135deg, rgba(19, 124, 139, 0.1) 0%, rgba(112, 156, 167, 0.1) 100%);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(19, 124, 139, 0.15);
}

.objective-badge::before {
    content: '‚úì';
    position: absolute;
    left: 8px;
    top: 50%;
    transform: translateY(-50%);
    width: 16px;
    height: 16px;
    background: var(--qlower-primary);
    border-radius: 50%;
    color: white;
    font-size: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
}

.objective-badge {
    padding-left: 32px;
}

/* SECTIONS DYNAMIQUES MODERNES */
.dynamic-section {
    background: linear-gradient(135deg, rgba(248, 249, 250, 0.8) 0%, rgba(255, 255, 255, 0.9) 100%);
    border-radius: 12px;
    padding: 20px;
    margin: 20px 0;
    border: 1px solid rgba(19, 124, 139, 0.1);
    backdrop-filter: blur(10px);
}

.dynamic-section-title {
    font-size: 16px;
    font-weight: 700;
    color: var(--qlower-primary);
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.dynamic-section-icon {
    width: 24px;
    height: 24px;
    background: var(--qlower-primary);
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 12px;
}

.dynamic-item {
    background: var(--qlower-white);
    border-radius: 8px;
    padding: 8px;
    margin-bottom: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    border: 1px solid var(--qlower-border);
}


.dynamic-item:last-child {
    margin-bottom: 0;
}

/* SOUS-SECTIONS √âPARGNE & PATRIMOINE */
.revenue-subsection {
    margin-top: 32px;
}

.revenue-subsection:first-of-type {
    margin-top: 2px;
}

.revenue-subsection-title {
    font-size: 16px;
    font-weight: 700;
    color: var(--qlower-primary);
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.revenue-subsection-title i {
    color: var(--qlower-primary);
}

/* Styles compacts pour liquidit√©s */
.liquidites-compact-list {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.liquidites-compact-item {
    display: flex;
    justify-content: space-between;
    padding: 8px 12px;
    background: var(--qlower-white);
    border: 1px solid var(--qlower-border);
    border-radius: 6px;
}

.liquidites-compact-name {
    font-size: 14px;
    color: var(--qlower-text-dark);
    font-weight: 500;
}

.liquidites-compact-value {
    font-size: 14px;
    color: var(--qlower-primary);
    font-weight: 700;
}

.liquidites-compact-item-total {
    display: flex;
    justify-content: space-between;
    padding: 10px 12px;
    background: linear-gradient(135deg, var(--qlower-primary) 0%, var(--qlower-light) 100%);
    border-radius: 6px;
    margin-top: 8px;
}

.liquidites-compact-name-total,
.liquidites-compact-value-total {
    color: white !important;
    font-weight: 700;
}

/* Styles compacts pour placements */
.placements-compact-list {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.placements-compact-item {
    display: flex;
    justify-content: space-between;
    padding: 8px 12px;
    background: var(--qlower-white);
    border: 1px solid var(--qlower-border);
    border-radius: 6px;
}

.placements-compact-name {
    font-size: 14px;
    color: var(--qlower-text-dark);
    font-weight: 500;
}

.placements-compact-value {
    font-size: 14px;
    color: var(--qlower-primary);
    font-weight: 700;
}

.placements-compact-item-total {
    display: flex;
    justify-content: space-between;
    padding: 10px 12px;
    background: linear-gradient(135deg, var(--qlower-primary) 0%, var(--qlower-light) 100%);
    border-radius: 6px;
    margin-top: 8px;
}

.placements-compact-name-total,
.placements-compact-value-total {
    color: white !important;
    font-weight: 700;
}

/* Styles compacts pour immobilier */
.immobilier-compact-list {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.immobilier-compact-item {
    display: flex;
    justify-content: space-between;
    padding: 8px 12px;
    background: var(--qlower-white);
    border: 1px solid var(--qlower-border);
    border-radius: 6px;
}

.immobilier-compact-name {
    font-size: 14px;
    color: var(--qlower-text-dark);
    font-weight: 500;
}

.immobilier-compact-value {
    font-size: 14px;
    color: var(--qlower-primary);
    font-weight: 700;
}

.immobilier-view-item {
    background: rgba(248, 249, 250, 0.5);
    border-radius: 8px;
    padding: 16px;
    margin-bottom: 16px;
}

.revenue-subsection-subtitle {
    font-size: 14px;
    font-weight: 600;
    color: var(--qlower-text-dark);
    margin-bottom: 8px;
}

/* SECTION CR√âDIT IMMOBILIER */
.credit-section {
    background: rgba(19, 124, 139, 0.03);
    border-radius: 8px;
    padding: 16px;
    margin-top: 12px;
    border-left: 3px solid var(--qlower-primary);
}

.credit-title {
    font-size: 14px;
    font-weight: 600;
    color: var(--qlower-primary);
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.credit-details {
    margin-left: 8px;
}

/* TOTAUX SECTION MODERNE */
.section-total {
    background: linear-gradient(135deg, var(--qlower-primary) 0%, var(--qlower-light) 100%);
    color: white;
    border-radius: 12px;
    padding: 20px 24px;
    margin-top: 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 4px 20px rgba(19, 124, 139, 0.25);
    position: relative;
    overflow: hidden;
}

.section-total::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
    transition: left 0.6s;
}

.section-total:hover::before {
    left: 100%;
}

.total-label {
    font-size: 16px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
}

.total-icon {
    width: 24px;
    height: 24px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
}

.total-value {
    font-family: 'SF Mono', 'Monaco', 'Menlo', monospace;
    font-size: 20px;
    font-weight: 900;
    text-shadow: 0 1px 2px rgba(0,0,0,0.1);
}

/* BILAN PATRIMONIAL FINAL COMPACT */
.patrimoine-final {
    background: linear-gradient(135deg, var(--qlower-dark) 0%, var(--qlower-primary) 100%);
    color: white;
    border-radius: 16px;
    padding: 24px;
    margin-top: 24px;
    text-align: center;
    position: relative;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(19, 124, 139, 0.25);
    border: 2px solid rgba(255, 255, 255, 0.1);
}

.patrimoine-final::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
    transition: left 0.8s ease;
}

.patrimoine-final:hover::before {
    left: 100%;
}

.patrimoine-icon {
    width: 48px;
    height: 48px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    margin: 0 auto 16px;
    backdrop-filter: blur(10px);
}

.patrimoine-title {
    font-family: 'Inter', sans-serif;
    font-size: 18px;
    font-weight: 700;
    margin-bottom: 8px;
    letter-spacing: -0.025em;
    color: white;
}

.patrimoine-value {
    font-family: 'Inter', sans-serif;
    font-size: 32px;
    font-weight: 800;
    margin-bottom: 12px;
    text-shadow: 0 1px 2px rgba(0,0,0,0.1);
    color: white;
    letter-spacing: -0.05em;
}

.patrimoine-details {
    font-size: 15px;
    font-weight: 500;
    opacity: 0.9;
    color: white;
}

/* GRILLES RESPONSIVES */
.platform-grid {
    display: grid;
    gap: 24px;
}

.platform-grid-2 {
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
}

.platform-grid-3 {
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
}

/* RESPONSIVE */
@media (max-width: 768px) {
    .investor-dashboard {
        padding: 16px;
    }
    
    .platform-grid-2,
    .platform-grid-3 {
        grid-template-columns: 1fr;
    }
    
    .platform-card-body {
        padding: 20px;
    }
    
    .data-item {
        padding: 14px 0;
    }
    
    .data-label,
    .data-value {
        font-size: 14px;
    }
    
    .patrimoine-value {
        font-size: 36px;
    }
}

/* √âTATS SP√âCIAUX */
.data-item.highlighted {
    background: linear-gradient(90deg, rgba(19, 124, 139, 0.05) 0%, transparent 100%);
    border-left: 3px solid var(--qlower-primary);
    padding-left: 16px;
    border-radius: 0 8px 8px 0;
}

/* CRYPTO LAYOUT */
.crypto-layout {
    display: flex !important;
    justify-content: space-between;
    align-items: center;
    padding: 16px 0;
    border-bottom: 1px solid var(--qlower-border);
}

.crypto-symbol {
    font-size: 15px;
    font-weight: 500;
    color: var(--qlower-text-dark);
    min-width: 60px;
    flex: 0 0 auto;
}

.crypto-quantity {
    flex: 1;
    text-align: center;
    color: var(--qlower-text-dark);
    font-size: 15px;
    font-weight: 500;
}

.crypto-value {
    font-size: 15px;
    font-weight: 600;
    color: var(--qlower-dark);
    min-width: 80px;
    text-align: right;
    flex: 0 0 auto;
}

.crypto-value .loading {
    color: var(--qlower-text-light);
    font-style: italic;
    font-weight: 400;
}

.crypto-value .error {
    color: #dc3545;
    font-size: 14px;
}

/* SUPER TOTAL PATRIMOINE */
.patrimoine-super-total {
    background: linear-gradient(135deg, var(--qlower-dark) 0%, var(--qlower-primary) 100%);
    color: white;
    border-radius: 16px;
    padding: 24px 20px;
    margin-top: 32px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 8px 32px rgba(19, 124, 139, 0.25);
    border: 2px solid rgba(255, 255, 255, 0.1);
    position: relative;
    overflow: hidden;
}

.patrimoine-super-total::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
    transition: left 0.8s ease;
}

.patrimoine-super-total:hover::before {
    left: 100%;
}

.patrimoine-super-label {
    font-size: 18px;
    font-weight: 700;
    color: white;
    letter-spacing: -0.025em;
}

.patrimoine-super-value {
    font-size: 24px;
    font-weight: 800;
    color: white;
    font-family: 'Inter', sans-serif;
    letter-spacing: -0.05em;
}

.empty-state {
    text-align: center;
    padding: 60px 40px;
    color: var(--qlower-text-light);
}

.empty-state-icon {
    font-size: 64px;
    margin-bottom: 24px;
    opacity: 0.3;
}

.empty-state-title {
    font-size: 20px;
    font-weight: 600;
    color: var(--qlower-text-dark);
    margin-bottom: 12px;
}

.empty-state-text {
    font-size: 14px;
    margin-bottom: 24px;
}

.platform-btn-primary {
    background: linear-gradient(135deg, var(--qlower-primary) 0%, var(--qlower-light) 100%);
    color: white;
    padding: 12px 24px;
    border-radius: 12px;
    font-weight: 600;
    font-size: 14px;
    border: none;
    cursor: pointer;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s ease;
}

.platform-btn-primary:hover {
    background: linear-gradient(135deg, #0f6b75 0%, #5d8a94 100%);
    transform: translateY(-1px);
    box-shadow: 0 6px 20px rgba(19, 124, 139, 0.3);
    color: white;
}
</style>

{% if current_user.investor_profile %}
<div class="investor-dashboard">
    
    <!-- INFORMATIONS PERSONNELLES -->
    <div class="platform-card">
        <div class="platform-card-header">
            <div>
                <div class="platform-card-title">INFORMATIONS PERSONNELLES</div>
                <div class="platform-card-subtitle">Vos donn√©es personnelles et de contact</div>
            </div>
        </div>
        <div class="platform-card-body">
            <div class="data-list">
                {% if current_user.investor_profile.civilite %}
                <div class="data-item">
                    <div class="data-label">
                        Civilit√©
                    </div>
                    <div class="data-value">{{ current_user.investor_profile.civilite }}</div>
                </div>
                {% endif %}
                
                <div class="data-item">
                    <div class="data-label">
                        Nom complet
                    </div>
                    <div class="data-value">{{ current_user.first_name }} {{ current_user.last_name }}</div>
                </div>
                
                {% if current_user.investor_profile.family_situation %}
                <div class="data-item">
                    <div class="data-label">
                        Situation familiale
                    </div>
                    <div class="data-value">{{ current_user.investor_profile.family_situation }}</div>
                </div>
                {% endif %}
                
                <div class="data-item">
                    <div class="data-label">
                        Email
                    </div>
                    <div class="data-value">{{ current_user.email }}</div>
                </div>
                
                {% if current_user.phone %}
                <div class="data-item">
                    <div class="data-label">
                        T√©l√©phone
                    </div>
                    <div class="data-value">{{ current_user.phone }}</div>
                </div>
                {% endif %}
                
                {% if current_user.investor_profile.nationalite %}
                <div class="data-item">
                    <div class="data-label">
                        Nationalit√©
                    </div>
                    <div class="data-value">{{ current_user.investor_profile.nationalite }}</div>
                </div>
                {% endif %}
                
                {% if current_user.investor_profile.date_naissance %}
                <div class="data-item">
                    <div class="data-label">
                        Date de naissance
                    </div>
                    <div class="data-value">{{ current_user.investor_profile.date_naissance.strftime('%d/%m/%Y') }}</div>
                </div>
                {% endif %}
                
                {% if current_user.investor_profile.lieu_naissance %}
                <div class="data-item">
                    <div class="data-label">
                        Lieu de naissance
                    </div>
                    <div class="data-value">{{ current_user.investor_profile.lieu_naissance }}</div>
                </div>
                {% endif %}
                
                {% if current_user.investor_profile.pays_residence %}
                <div class="data-item">
                    <div class="data-label">
                        Pays de r√©sidence
                    </div>
                    <div class="data-value">{{ current_user.investor_profile.pays_residence }}</div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- OBJECTIFS D'INVESTISSEMENT -->
    <div class="platform-card">
        <div class="platform-card-header">
            <div>
                <div class="platform-card-title">OBJECTIFS D'INVESTISSEMENT</div>
                <div class="platform-card-subtitle">Vos motivations et buts financiers</div>
            </div>
        </div>
        <div class="platform-card-body">
            <div class="objectives-container">
                {% if current_user.investor_profile.objectif_premiers_pas %}
                <div class="objective-badge">Faire mes premiers pas dans l'investissement</div>
                {% endif %}
                {% if current_user.investor_profile.objectif_constituer_capital %}
                <div class="objective-badge">Constituer progressivement un capital</div>
                {% endif %}
                {% if current_user.investor_profile.objectif_diversifier %}
                <div class="objective-badge">Diversifier mes placements</div>
                {% endif %}
                {% if current_user.investor_profile.objectif_optimiser_rendement %}
                <div class="objective-badge">Optimiser le rendement de mon √©pargne</div>
                {% endif %}
                {% if current_user.investor_profile.objectif_preparer_retraite %}
                <div class="objective-badge">Pr√©parer ma retraite</div>
                {% endif %}
                {% if current_user.investor_profile.objectif_securite_financiere %}
                <div class="objective-badge">Assurer ma s√©curit√© financi√®re √† long terme</div>
                {% endif %}
                {% if current_user.investor_profile.objectif_projet_immobilier %}
                <div class="objective-badge">Financer un projet immobilier</div>
                {% endif %}
                {% if current_user.investor_profile.objectif_revenus_complementaires %}
                <div class="objective-badge">G√©n√©rer des revenus compl√©mentaires</div>
                {% endif %}
                {% if current_user.investor_profile.objectif_transmettre_capital %}
                <div class="objective-badge">Transmettre un capital √† mes proches</div>
                {% endif %}
                {% if current_user.investor_profile.objectif_proteger_famille %}
                <div class="objective-badge">Prot√©ger ma famille en cas d'impr√©vu</div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- PROFIL DE RISQUE -->
    <div class="platform-card">
        <div class="platform-card-header">
            <div>
                <div class="platform-card-title">PROFIL DE RISQUE</div>
                <div class="platform-card-subtitle">Votre approche face au risque et √† la volatilit√©</div>
            </div>
        </div>
        <div class="platform-card-body">
            <div class="data-list">
                {% if current_user.investor_profile.tolerance_risque %}
                <div class="data-item">
                    <div class="data-label">
                        Profil de risque
                    </div>
                    <div class="data-value">
                        {% if current_user.investor_profile.tolerance_risque == 'faible' %}
                            Prudent
                        {% elif current_user.investor_profile.tolerance_risque == 'moderee' %}
                            Mod√©r√©
                        {% elif current_user.investor_profile.tolerance_risque == 'elevee' %}
                            Dynamique
                        {% endif %}
                    </div>
                </div>
                {% endif %}
                
            </div>
        </div>
    </div>

    <!-- REVENUS ET CHARGES -->
    <div class="platform-card">
        <div class="platform-card-header">
            <div>
                <div class="platform-card-title">REVENUS ET CHARGES</div>
                <div class="platform-card-subtitle">Votre situation financi√®re mensuelle</div>
            </div>
        </div>
        <div class="platform-card-body">
            <div class="data-list">
                {% if current_user.investor_profile.professional_situation %}
                <div class="data-item">
                    <div class="data-label">
                        Situation professionnelle
                    </div>
                    <div class="data-value">{{ current_user.investor_profile.professional_situation }}</div>
                </div>
                {% endif %}
                
                {% if current_user.investor_profile.professional_situation_other %}
                <div class="data-item">
                    <div class="data-label">
                        Pr√©cisions
                    </div>
                    <div class="data-value">{{ current_user.investor_profile.professional_situation_other }}</div>
                </div>
                {% endif %}
                
                {% if current_user.investor_profile.metier %}
                <div class="data-item">
                    <div class="data-label">
                        M√©tier
                    </div>
                    <div class="data-value">{{ current_user.investor_profile.metier }}</div>
                </div>
                {% endif %}
                
                {% if current_user.investor_profile.monthly_net_income %}
                <div class="data-item">
                    <div class="data-label">
                        Revenu mensuel net
                    </div>
                    <div class="data-value financial">{{ "{:,.0f}".format(current_user.investor_profile.monthly_net_income) }}‚Ç¨</div>
                </div>
                {% endif %}
                
                {% if current_user.investor_profile.impots_mensuels %}
                <div class="data-item">
                    <div class="data-label">
                        Imp√¥ts mensuels
                    </div>
                    <div class="data-value financial">{{ "{:,.0f}".format(current_user.investor_profile.impots_mensuels) }}‚Ç¨</div>
                </div>
                {% endif %}
                
                {% if current_user.investor_profile.monthly_savings_capacity %}
                <div class="data-item">
                    <div class="data-label">
                        Capacit√© d'√©pargne mensuelle
                    </div>
                    <div class="data-value financial">{{ "{:,.0f}".format(current_user.investor_profile.monthly_savings_capacity) }}‚Ç¨</div>
                </div>
                {% endif %}
                
                {% if current_user.investor_profile.monthly_net_income and current_user.investor_profile.monthly_savings_capacity %}
                {% set taux_epargne = (current_user.investor_profile.monthly_savings_capacity / current_user.investor_profile.monthly_net_income * 100) %}
                <div class="data-item">
                    <div class="data-label">
                        Taux d'√©pargne
                    </div>
                    <div class="data-value">{{ "{:.1f}".format(taux_epargne) }}%</div>
                </div>
                {% endif %}
            </div>
            
            <!-- Revenus compl√©mentaires -->
            {% if current_user.investor_profile.revenus_complementaires_data %}
            <div class="dynamic-section">
                <div class="dynamic-section-title">
                    Revenus compl√©mentaires
                </div>
                {% for revenu in current_user.investor_profile.revenus_complementaires_data %}
                <div class="dynamic-item">
                    <div class="data-item">
                        <div class="data-label">{{ revenu.name }}</div>
                        <div class="data-value financial">{{ "{:,.0f}".format(revenu.amount) }}‚Ç¨/mois</div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            
            <!-- Charges mensuelles -->
            {% if current_user.investor_profile.charges_mensuelles_data %}
            <div class="dynamic-section">
                <div class="dynamic-section-title">
                    Charges mensuelles
                </div>
                {% for charge in current_user.investor_profile.charges_mensuelles_data %}
                <div class="dynamic-item">
                    <div class="data-item">
                        <div class="data-label">{{ charge.name }}</div>
                        <div class="data-value">{{ "{:,.0f}".format(charge.amount) }}‚Ç¨/mois</div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
    </div>

    <!-- √âPARGNE ET PLACEMENTS -->
    <div class="platform-card">
        <div class="platform-card-header">
            <div>
                <div class="platform-card-title">√âPARGNE & PATRIMOINE</div>
                <div class="platform-card-subtitle">Situation patrimoniale compl√®te : liquidit√©s, placements, immobilier et autres actifs</div>
            </div>
        </div>
        <div class="platform-card-body">
            <!-- Initialisation des totaux -->
            {% set total_liquidites = 0 %}
            {% set total_placements = 0 %}
            {% set total_immobilier_brut = 0 %}
            {% set total_credits_immobilier = 0 %}
            {% set total_crypto = 0 %}
            {% set total_autres_biens = 0 %}
            
            <!-- Sous-section LIQUIDIT√âS -->
            {% set has_liquidites = false %}
            
            {% if current_user.investor_profile.livret_a_value or current_user.investor_profile.ldds_value or current_user.investor_profile.pel_cel_value or current_user.investor_profile.current_account_value or current_user.investor_profile.liquidites_personnalisees_data %}
                {% set has_liquidites = true %}
            {% endif %}
            
            {% if has_liquidites %}
            <div class="revenue-subsection">
                <h4 class="revenue-subsection-title">
                    <i class="fas fa-tint"></i>
                    Liquidit√©s
                </h4>
                <div class="data-list">
                    {% if current_user.investor_profile.livret_a_value %}
                        <div class="data-item">
                            <div class="data-label">Livret A</div>
                            <div class="data-value">{{ "{:,.0f}".format(current_user.investor_profile.livret_a_value) }}‚Ç¨</div>
                        </div>
                        {% set total_liquidites = total_liquidites + current_user.investor_profile.livret_a_value %}
                    {% endif %}
                    
                    {% if current_user.investor_profile.ldds_value %}
                        <div class="data-item">
                            <div class="data-label">LDDS</div>
                            <div class="data-value">{{ "{:,.0f}".format(current_user.investor_profile.ldds_value) }}‚Ç¨</div>
                        </div>
                        {% set total_liquidites = total_liquidites + current_user.investor_profile.ldds_value %}
                    {% endif %}
                    
                    {% if current_user.investor_profile.pel_cel_value %}
                        <div class="data-item">
                            <div class="data-label">PEL/CEL</div>
                            <div class="data-value">{{ "{:,.0f}".format(current_user.investor_profile.pel_cel_value) }}‚Ç¨</div>
                        </div>
                        {% set total_liquidites = total_liquidites + current_user.investor_profile.pel_cel_value %}
                    {% endif %}
                    
                    {% if current_user.investor_profile.current_account_value %}
                        <div class="data-item">
                            <div class="data-label">Compte courant</div>
                            <div class="data-value">{{ "{:,.0f}".format(current_user.investor_profile.current_account_value) }}‚Ç¨</div>
                        </div>
                        {% set total_liquidites = total_liquidites + current_user.investor_profile.current_account_value %}
                    {% endif %}
                    
                    {% if current_user.investor_profile.liquidites_personnalisees_data %}
                        {% for liquidite in current_user.investor_profile.liquidites_personnalisees_data %}
                        <div class="data-item">
                            <div class="data-label">{{ liquidite.name }}</div>
                            <div class="data-value">{{ "{:,.0f}".format(liquidite.amount) }}‚Ç¨</div>
                        </div>
                        {% set total_liquidites = total_liquidites + liquidite.amount %}
                        {% endfor %}
                    {% endif %}
                    
                    <div class="liquidites-compact-item-total">
                        <div class="liquidites-compact-name-total">Total Liquidit√©s</div>
                        <div class="liquidites-compact-value-total">{{ "{:,.0f}".format(total_liquidites) }}‚Ç¨</div>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <!-- Sous-section PLACEMENTS FINANCIERS -->
            {% set has_placements = false %}
            
            {% if current_user.investor_profile.pea_value or current_user.investor_profile.per_value or current_user.investor_profile.life_insurance_value or current_user.investor_profile.cto_value or current_user.investor_profile.pee_perco_value or current_user.investor_profile.private_equity_value or current_user.investor_profile.scpi_value or current_user.investor_profile.placements_personnalises_data %}
                {% set has_placements = true %}
            {% endif %}
            
            {% if has_placements %}
            <div class="revenue-subsection">
                <h4 class="revenue-subsection-title">
                    <i class="fas fa-chart-line"></i>
                    Placements Financiers
                </h4>
                <div class="data-list">
                    {% if current_user.investor_profile.pea_value %}
                        <div class="data-item">
                            <div class="data-label">PEA</div>
                            <div class="data-value">{{ "{:,.0f}".format(current_user.investor_profile.pea_value) }}‚Ç¨</div>
                        </div>
                        {% set total_placements = total_placements + current_user.investor_profile.pea_value %}
                    {% endif %}
                    
                    {% if current_user.investor_profile.per_value %}
                        <div class="data-item">
                            <div class="data-label">PER</div>
                            <div class="data-value">{{ "{:,.0f}".format(current_user.investor_profile.per_value) }}‚Ç¨</div>
                        </div>
                        {% set total_placements = total_placements + current_user.investor_profile.per_value %}
                    {% endif %}
                    
                    {% if current_user.investor_profile.life_insurance_value %}
                        <div class="data-item">
                            <div class="data-label">Assurance Vie</div>
                            <div class="data-value">{{ "{:,.0f}".format(current_user.investor_profile.life_insurance_value) }}‚Ç¨</div>
                        </div>
                        {% set total_placements = total_placements + current_user.investor_profile.life_insurance_value %}
                    {% endif %}
                    
                    {% if current_user.investor_profile.cto_value %}
                        <div class="data-item">
                            <div class="data-label">CTO</div>
                            <div class="data-value">{{ "{:,.0f}".format(current_user.investor_profile.cto_value) }}‚Ç¨</div>
                        </div>
                        {% set total_placements = total_placements + current_user.investor_profile.cto_value %}
                    {% endif %}
                    
                    {% if current_user.investor_profile.pee_perco_value %}
                        <div class="data-item">
                            <div class="data-label">PEE/PERCO</div>
                            <div class="data-value">{{ "{:,.0f}".format(current_user.investor_profile.pee_perco_value) }}‚Ç¨</div>
                        </div>
                        {% set total_placements = total_placements + current_user.investor_profile.pee_perco_value %}
                    {% endif %}
                    
                    {% if current_user.investor_profile.private_equity_value %}
                        <div class="data-item">
                            <div class="data-label">Private Equity</div>
                            <div class="data-value">{{ "{:,.0f}".format(current_user.investor_profile.private_equity_value) }}‚Ç¨</div>
                        </div>
                        {% set total_placements = total_placements + current_user.investor_profile.private_equity_value %}
                    {% endif %}
                    
                    {% if current_user.investor_profile.scpi_value %}
                        <div class="data-item">
                            <div class="data-label">SCPI</div>
                            <div class="data-value">{{ "{:,.0f}".format(current_user.investor_profile.scpi_value) }}‚Ç¨</div>
                        </div>
                        {% set total_placements = total_placements + current_user.investor_profile.scpi_value %}
                    {% endif %}
                    
                    {% if current_user.investor_profile.placements_personnalises_data %}
                        {% for placement in current_user.investor_profile.placements_personnalises_data %}
                        <div class="data-item">
                            <div class="data-label">{{ placement.name }}</div>
                            <div class="data-value">{{ "{:,.0f}".format(placement.amount) }}‚Ç¨</div>
                        </div>
                        {% set total_placements = total_placements + placement.amount %}
                        {% endfor %}
                    {% endif %}
                    
                    <div class="placements-compact-item-total">
                        <div class="placements-compact-name-total">Total Placements</div>
                        <div class="placements-compact-value-total">{{ "{:,.0f}".format(total_placements) }}‚Ç¨</div>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <!-- Sous-section IMMOBILIER -->
            {% if current_user.investor_profile.immobilier_data %}
            <div class="revenue-subsection">
                <h4 class="revenue-subsection-title">
                    <i class="fas fa-home"></i>
                    Immobilier
                </h4>
                
                {% for bien in current_user.investor_profile.immobilier_data %}
                <div class="dynamic-section">
                    <div class="dynamic-section-title">
                        {% if bien.type == 'residence_principale' %}
                            üè† R√©sidence principale
                        {% elif bien.type == 'residence_secondaire' %}
                            üèñÔ∏è R√©sidence secondaire
                        {% elif bien.type == 'investissement_locatif' %}
                            üè¢ {{ bien.description or 'Investissement locatif' }}
                        {% endif %}
                    </div>
                    
                    <div class="dynamic-item">
                        <div class="data-item">
                            <div class="data-label">Valeur du bien</div>
                            <div class="data-value financial">{{ "{:,.0f}".format(bien.valeur) }}‚Ç¨</div>
                        </div>
                    </div>
                    
                    {% if bien.surface %}
                    <div class="dynamic-item">
                        <div class="data-item">
                            <div class="data-label">Surface</div>
                            <div class="data-value">{{ bien.surface }} m¬≤</div>
                        </div>
                    </div>
                    
                    {% if bien.valeur and bien.surface %}
                    {% set prix_m2 = (bien.valeur / bien.surface)|round|int %}
                    <div class="dynamic-item">
                        <div class="data-item">
                            <div class="data-label">Prix au m¬≤</div>
                            <div class="data-value">{{ "{:,.0f}".format(prix_m2) }}‚Ç¨/m¬≤</div>
                        </div>
                    </div>
                    {% endif %}
                    {% endif %}
                    
                    {% if bien.has_credit and bien.credit_montant %}
                        {# Calcul approximatif du capital restant bas√© sur les donn√©es disponibles #}
                        {% set credit_initial = bien.credit_montant %}
                        {% set credit_duree_annees = bien.get('credit_duree', 25) %}
                        {% set credit_date = bien.get('credit_date', '2025-01') %}
                        
                        {# Estimation simple du capital restant (√† ajuster selon les calculs r√©els) #}
                        {% if credit_date == '2025-10' and credit_initial == 215000 %}
                            {% set capital_restant = 212882 %} {# Valeur exacte pour appartement #}
                            {% set mensualite = 1059 %}
                        {% elif credit_date == '2025-01' and credit_initial == 347000 %}
                            {% set capital_restant = 324804 %} {# Valeur exacte pour r√©sidence principale #}
                            {% set mensualite = 2018 %}
                        {% else %}
                            {% set capital_restant = credit_initial * 0.9 %} {# Approximation par d√©faut #}
                            {% set mensualite = 0 %}
                        {% endif %}
                        {% set valeur_nette = bien.valeur - capital_restant %}
                    {% else %}
                        {% set capital_restant = 0 %}
                        {% set mensualite = 0 %}
                        {% set valeur_nette = bien.valeur %}
                    {% endif %}
                    <div class="liquidites-compact-item-total" style="margin-top: 8px;">
                        <div class="liquidites-compact-name-total">Valeur nette</div>
                        <div class="liquidites-compact-value-total">{{ "{:,.0f}".format(valeur_nette) }}‚Ç¨</div>
                    </div>
                    
                    {% if bien.has_credit %}
                    <div class="revenue-subsection-subtitle" style="margin-top: 20px; margin-bottom: 8px; color: var(--qlower-primary); font-weight: 600;">
                        üí≥ Cr√©dit immobilier associ√©
                    </div>
                    
                    {% if bien.credit_montant %}
                    <div class="dynamic-item">
                        <div class="data-item">
                            <div class="data-label">Montant initial</div>
                            <div class="data-value">{{ "{:,.0f}".format(bien.credit_montant) }}‚Ç¨</div>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if bien.credit_tag %}
                    <div class="dynamic-item">
                        <div class="data-item">
                            <div class="data-label">Taux TAG</div>
                            <div class="data-value">{{ bien.credit_tag }}%</div>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if bien.credit_taeg %}
                    <div class="dynamic-item">
                        <div class="data-item">
                            <div class="data-label">Taux TAEG</div>
                            <div class="data-value">{{ bien.credit_taeg }}%</div>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if bien.credit_duree %}
                    <div class="dynamic-item">
                        <div class="data-item">
                            <div class="data-label">Dur√©e</div>
                            <div class="data-value">{{ bien.credit_duree }} ans</div>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if bien.credit_date %}
                    <div class="dynamic-item">
                        <div class="data-item">
                            <div class="data-label">Date de d√©but</div>
                            <div class="data-value">{{ bien.credit_date }}</div>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if mensualite %}
                    <div class="dynamic-item">
                        <div class="data-item">
                            <div class="data-label">Mensualit√©</div>
                            <div class="data-value">{{ "{:,.0f}".format(mensualite) }}‚Ç¨</div>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if capital_restant %}
                    <div class="liquidites-compact-item-total" style="margin-top: 8px; background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);">
                        <div class="liquidites-compact-name-total">Montant restant du cr√©dit √† rembourser</div>
                        <div class="liquidites-compact-value-total">{{ "{:,.0f}".format(capital_restant) }}‚Ç¨</div>
                    </div>
                    {% if capital_restant %}
                        {% set total_credits_immobilier = total_credits_immobilier + capital_restant %}
                    {% endif %}
                    {% endif %}
                    {% endif %}
                </div>
                {% set total_immobilier_brut = total_immobilier_brut + bien.valeur %}
                {% endfor %}
                
                <div class="liquidites-compact-item-total">
                    <div class="liquidites-compact-name-total">Total Immobilier Net</div>
                    <div class="liquidites-compact-value-total">
                        {{ "{:,.0f}".format(current_user.investor_profile.calculated_total_immobilier_net or 0) }}‚Ç¨
                    </div>
                </div>
            </div>
            {% endif %}
            
            <!-- Sous-section CRYPTOMONNAIES -->
            {% if current_user.investor_profile.cryptomonnaies_data %}
            <div class="revenue-subsection">
                <h4 class="revenue-subsection-title">
                    <i class="fab fa-bitcoin"></i>
                    Cryptomonnaies
                </h4>
                <div class="data-list">
                    {% for crypto in current_user.investor_profile.cryptomonnaies_data %}
                    {% set crypto_symbol = 'BTC' if crypto.symbol.lower() in ['bitcoin', 'btc'] else 
                                          'ETH' if crypto.symbol.lower() in ['ethereum', 'eth'] else 
                                          'BNB' if crypto.symbol.lower() in ['binancecoin', 'bnb'] else 
                                          'ADA' if crypto.symbol.lower() in ['cardano', 'ada'] else 
                                          'SOL' if crypto.symbol.lower() in ['solana', 'sol'] else 
                                          'DOT' if crypto.symbol.lower() in ['polkadot', 'dot'] else 
                                          'MATIC' if crypto.symbol.lower() in ['matic', 'polygon'] else 
                                          'LINK' if crypto.symbol.lower() in ['chainlink', 'link'] else 
                                          'LTC' if crypto.symbol.lower() in ['litecoin', 'ltc'] else 
                                          'XRP' if crypto.symbol.lower() in ['ripple', 'xrp'] else 
                                          crypto.symbol.upper() %}
                    <div class="data-item crypto-layout">
                        <div class="crypto-symbol">{{ crypto_symbol }}</div>
                        <div class="crypto-quantity">{{ crypto.quantity }}</div>
                        <div class="crypto-value" data-symbol="{{ crypto.symbol.lower() }}" data-quantity="{{ crypto.quantity }}">
                            <span class="loading">Chargement...</span>
                        </div>
                    </div>
                    {% endfor %}
                    
                    <div class="liquidites-compact-item-total">
                        <div class="liquidites-compact-name-total">Total Cryptomonnaies</div>
                        <div class="liquidites-compact-value-total" id="totalCryptoValue">{{ "{:,.0f}".format(total_crypto) }}‚Ç¨</div>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <!-- Sous-section AUTRES BIENS -->
            {% if current_user.investor_profile.autres_biens_data %}
            <div class="revenue-subsection">
                <h4 class="revenue-subsection-title">
                    <i class="fas fa-gem"></i>
                    Autres Biens
                </h4>
                <div class="data-list">
                    {% for bien in current_user.investor_profile.autres_biens_data %}
                    <div class="data-item">
                        <div class="data-label">{{ bien.name }}</div>
                        <div class="data-value">{{ "{:,.0f}".format(bien.valeur) }}‚Ç¨</div>
                    </div>
                    {% set total_autres_biens = total_autres_biens + bien.valeur %}
                    {% endfor %}
                    
                    <div class="liquidites-compact-item-total">
                        <div class="liquidites-compact-name-total">Total Autres Biens</div>
                        <div class="liquidites-compact-value-total">{{ "{:,.0f}".format(current_user.investor_profile.calculated_total_autres_biens or 0) }}‚Ç¨</div>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <!-- Total Patrimoine -->
            {% set total_liquidites_calc = current_user.investor_profile.calculated_total_liquidites or 0 %}
            {% set total_placements_calc = current_user.investor_profile.calculated_total_placements or 0 %}
            {% set total_immobilier_calc = current_user.investor_profile.calculated_total_immobilier_net or 0 %}
            {% set total_autres_biens_calc = current_user.investor_profile.calculated_total_autres_biens or 0 %}
            {% set total_sans_crypto = total_liquidites_calc + total_placements_calc + total_immobilier_calc + total_autres_biens_calc %}
            
            <div class="patrimoine-super-total">
                <div class="patrimoine-super-label">Total √âpargne & Patrimoine</div>
                <div class="patrimoine-super-value" id="totalPatrimoineValue" 
                     data-total-sans-crypto="{{ total_sans_crypto }}">{{ "{:,.0f}".format(total_sans_crypto) }}‚Ç¨</div>
            </div>
        </div>
    </div>

    <!-- CR√âDITS -->
    {% if current_user.investor_profile.credits_data %}
    <div class="platform-card">
        <div class="platform-card-header">
            <div>
                <div class="platform-card-title">CR√âDITS (hors immobilier)</div>
                <div class="platform-card-subtitle">Vos cr√©dits √† la consommation et autres emprunts</div>
            </div>
        </div>
        <div class="platform-card-body">
            {% for credit in current_user.investor_profile.credits_data %}
            <div class="revenue-subsection">
                <h4 class="revenue-subsection-title">
                    <i class="fas fa-credit-card"></i>
                    {{ credit.description }}
                </h4>
                <div class="data-list">
                    <div class="data-item">
                        <div class="data-label">Montant initial</div>
                        <div class="data-value">{{ "{:,.0f}".format(credit.montant_initial) }}‚Ç¨</div>
                    </div>
                    
                    {% if credit.taux %}
                    <div class="data-item">
                        <div class="data-label">Taux d'int√©r√™t</div>
                        <div class="data-value">{{ credit.taux }}%</div>
                    </div>
                    {% endif %}
                    
                    {% if credit.duree %}
                    <div class="data-item">
                        <div class="data-label">Dur√©e</div>
                        <div class="data-value">{{ credit.duree }} ans</div>
                    </div>
                    {% endif %}
                    
                    {% if credit.date_depart %}
                    <div class="data-item">
                        <div class="data-label">Date de d√©but</div>
                        <div class="data-value">{{ credit.date_depart }}</div>
                    </div>
                    {% endif %}
                    
                    {% if credit.get('mensualite') %}
                    <div class="data-item">
                        <div class="data-label">Mensualit√©</div>
                        <div class="data-value">{{ "{:,.0f}".format(credit.mensualite) }}‚Ç¨/mois</div>
                    </div>
                    {% endif %}
                    
                    <div class="liquidites-compact-item-total" style="background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);">
                        <div class="liquidites-compact-name-total">Capital restant d√ª</div>
                        <div class="liquidites-compact-value-total">{{ "{:,.0f}".format(credit.get('capital_restant', credit.get('montant_restant', credit.montant_initial))) }}‚Ç¨</div>
                    </div>
                </div>
            </div>
            {% endfor %}
            
            <div class="patrimoine-super-total" style="background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);">
                <div class="patrimoine-super-label">Total Cr√©dits √† Rembourser</div>
                <div class="patrimoine-super-value">{{ "{:,.0f}".format(current_user.investor_profile.calculated_total_credits_consommation or 0) }}‚Ç¨</div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- BILAN PATRIMONIAL FINAL SPECTACULAIRE -->
    {% set total_liquidites_calc = current_user.investor_profile.calculated_total_liquidites or 0 %}
    {% set total_placements_calc = current_user.investor_profile.calculated_total_placements or 0 %}
    {% set total_immobilier_calc = current_user.investor_profile.calculated_total_immobilier_net or 0 %}
    {% set total_autres_biens_calc = current_user.investor_profile.calculated_total_autres_biens or 0 %}
    {% set total_actifs_sans_crypto = total_liquidites_calc + total_placements_calc + total_immobilier_calc + total_autres_biens_calc %}
    {% set total_passifs = current_user.investor_profile.calculated_total_credits_consommation or 0 %}
    
    <div class="patrimoine-final">
        <div class="patrimoine-icon">
            <i class="fas fa-crown"></i>
        </div>
        <div class="patrimoine-title">PATRIMOINE NET TOTAL</div>
        <div class="patrimoine-value" id="patrimoineNetValue" 
             data-actifs-sans-crypto="{{ total_actifs_sans_crypto }}"
             data-passifs="{{ total_passifs }}">{{ "{:,.0f}".format(total_actifs_sans_crypto - total_passifs) }}‚Ç¨</div>
        <div class="patrimoine-details">
            Total Actifs: <span id="totalActifsDetail" data-sans-crypto="{{ total_actifs_sans_crypto }}">{{ "{:,.0f}".format(total_actifs_sans_crypto) }}‚Ç¨</span> ‚Ä¢ Total Dettes: {{ "{:,.0f}".format(total_passifs) }}‚Ç¨
        </div>
    </div>
</div>

{% else %}
<!-- Utilisateur sans profil investisseur -->
<div class="investor-dashboard">
    <div class="platform-card">
        <div class="platform-card-body">
            <div class="empty-state">
                <div class="empty-state-icon">
                    <i class="fas fa-user-slash"></i>
                </div>
                <div class="empty-state-title">Profil investisseur non compl√©t√©</div>
                <div class="empty-state-text">Compl√©tez votre profil pour acc√©der √† vos donn√©es financi√®res d√©taill√©es et b√©n√©ficier de nos conseils personnalis√©s.</div>
                <a href="{{ url_for('platform_investor.investor_data', edit=True) }}" class="platform-btn-primary">
                    <i class="fas fa-plus"></i>
                    Compl√©ter mon profil
                </a>
            </div>
        </div>
    </div>
</div>
{% endif %}

{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    loadCryptoPrices();
});

async function loadCryptoPrices() {
    const cryptoElements = document.querySelectorAll('.crypto-value');
    if (cryptoElements.length === 0) return;
    
    // Collecter tous les symbols uniques
    const symbols = [];
    const symbolToId = {
        'btc': 'bitcoin',
        'eth': 'ethereum', 
        'bnb': 'binancecoin',
        'ada': 'cardano',
        'sol': 'solana',
        'dot': 'polkadot',
        'matic': 'matic-network',
        'link': 'chainlink',
        'ltc': 'litecoin',
        'xrp': 'ripple'
    };
    
    cryptoElements.forEach(el => {
        const symbol = el.dataset.symbol.toLowerCase();
        if (!symbols.includes(symbol)) {
            symbols.push(symbol);
        }
    });
    
    // Mapper vers les IDs CoinGecko
    const coinIds = symbols.map(symbol => symbolToId[symbol] || symbol);
    
    try {
        // Appeler l'API CoinGecko
        const response = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${coinIds.join(',')}&vs_currencies=eur`);
        const prices = await response.json();
        
        // Mettre √† jour chaque crypto
        let totalValue = 0;
        cryptoElements.forEach(el => {
            const symbol = el.dataset.symbol.toLowerCase();
            const quantity = parseFloat(el.dataset.quantity);
            const coinId = symbolToId[symbol] || symbol;
            
            if (prices[coinId] && prices[coinId].eur) {
                const price = prices[coinId].eur;
                const value = price * quantity;
                totalValue += value;
                
                el.innerHTML = `${value.toLocaleString('fr-FR', {
                    style: 'currency',
                    currency: 'EUR',
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                })}`;
            } else {
                el.innerHTML = '<span class="error">Prix indisponible</span>';
            }
        });
        
        // Mettre √† jour le total crypto
        const totalCryptoElement = document.getElementById('totalCryptoValue');
        if (totalCryptoElement) {
            const formattedValue = Math.round(totalValue).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            totalCryptoElement.textContent = `${formattedValue}‚Ç¨`;
        }
        
        // Mettre √† jour le total patrimoine avec les cryptos
        updateTotalPatrimoine(totalValue);
        
    } catch (error) {
        console.error('Erreur lors du chargement des prix crypto:', error);
        cryptoElements.forEach(el => {
            el.innerHTML = '<span class="error">Erreur</span>';
        });
    }
}

function updateTotalPatrimoine(cryptoTotalValue) {
    // Mettre √† jour le "Total √âpargne & Patrimoine"
    const totalPatrimoineElement = document.getElementById('totalPatrimoineValue');
    if (totalPatrimoineElement) {
        const totalSansCrypto = parseFloat(totalPatrimoineElement.dataset.totalSansCrypto) || 0;
        const nouveauTotal = totalSansCrypto + cryptoTotalValue;
        
        const formattedTotal = Math.round(nouveauTotal).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        totalPatrimoineElement.textContent = `${formattedTotal}‚Ç¨`;
    }
    
    // Mettre √† jour le "PATRIMOINE NET TOTAL"
    const patrimoineNetElement = document.getElementById('patrimoineNetValue');
    const totalActifsDetailElement = document.getElementById('totalActifsDetail');
    
    if (patrimoineNetElement && totalActifsDetailElement) {
        const actifsSansCrypto = parseFloat(patrimoineNetElement.dataset.actifsSansCrypto) || 0;
        const passifs = parseFloat(patrimoineNetElement.dataset.passifs) || 0;
        
        const totalActifsAvecCrypto = actifsSansCrypto + cryptoTotalValue;
        const patrimoineNet = totalActifsAvecCrypto - passifs;
        
        // Formater les valeurs avec virgules
        const formattedActifs = Math.round(totalActifsAvecCrypto).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        const formattedPatrimoineNet = Math.round(patrimoineNet).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        
        // Mettre √† jour l'affichage
        patrimoineNetElement.textContent = `${formattedPatrimoineNet}‚Ç¨`;
        totalActifsDetailElement.textContent = `${formattedActifs}‚Ç¨`;
    }
}
</script>
{% endblock %}