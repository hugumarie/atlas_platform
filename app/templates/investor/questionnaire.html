{% extends "base.html" %}

{% block title %}Questionnaire Investisseur - Atlas{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="bg-primary text-white py-4 mb-4">
                <div class="container">
                    <h2 class="mb-2">
                        <i class="fas fa-clipboard-list me-2"></i>Profil Investisseur
                    </h2>
                    <p class="mb-0">Aidez-nous à mieux vous connaître pour personnaliser vos conseils</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <form method="POST" class="needs-validation" novalidate>
                    <!-- Section 1: Informations financières de base -->
                    <div class="card mb-4 shadow-sm">
                        <div class="card-header bg-light">
                            <h5 class="mb-0">
                                <i class="fas fa-euro-sign me-2 text-primary"></i>
                                Situation Financière Actuelle
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="monthly_net_income" class="form-label">
                                            Salaire net mensuel (€) *
                                        </label>
                                        <input type="number" class="form-control" id="monthly_net_income" 
                                               name="monthly_net_income" min="0" step="100" required>
                                        <div class="form-text">Votre revenu net mensuel principal</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="current_savings" class="form-label">
                                            Épargne actuelle totale (€) *
                                        </label>
                                        <input type="number" class="form-control" id="current_savings" 
                                               name="current_savings" min="0" step="500" required>
                                        <div class="form-text">Total de votre épargne disponible</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="monthly_savings_capacity" class="form-label">
                                    Capacité d'épargne mensuelle (€) *
                                </label>
                                <input type="number" class="form-control" id="monthly_savings_capacity" 
                                       name="monthly_savings_capacity" min="0" step="50" required>
                                <div class="form-text">Montant que vous pouvez épargner chaque mois</div>
                            </div>
                        </div>
                    </div>

                    <!-- Section 2: Profil de risque et objectifs -->
                    <div class="card mb-4 shadow-sm">
                        <div class="card-header bg-light">
                            <h5 class="mb-0">
                                <i class="fas fa-target me-2 text-success"></i>
                                Profil et Objectifs d'Investissement
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="risk_tolerance" class="form-label">
                                            Tolérance au risque *
                                        </label>
                                        <select class="form-select" id="risk_tolerance" name="risk_tolerance" required>
                                            <option value="">Sélectionnez...</option>
                                            <option value="conservateur">Conservateur - Je privilégie la sécurité</option>
                                            <option value="modéré">Modéré - J'accepte un risque limité</option>
                                            <option value="dynamique">Dynamique - J'accepte des risques pour plus de rendement</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="investment_experience" class="form-label">
                                            Expérience en investissement *
                                        </label>
                                        <select class="form-select" id="investment_experience" name="investment_experience" required>
                                            <option value="">Sélectionnez...</option>
                                            <option value="débutant">Débutant - Peu ou pas d'expérience</option>
                                            <option value="intermédiaire">Intermédiaire - Quelques années d'expérience</option>
                                            <option value="expérimenté">Expérimenté - Plus de 5 ans d'expérience</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="investment_goals" class="form-label">
                                    Objectifs d'investissement *
                                </label>
                                <textarea class="form-control" id="investment_goals" name="investment_goals" 
                                          rows="3" required placeholder="Ex: Préparer ma retraite, acheter une résidence principale, constituer un capital pour mes enfants..."></textarea>
                            </div>
                            
                            <div class="mb-3">
                                <label for="investment_horizon" class="form-label">
                                    Horizon de placement *
                                </label>
                                <select class="form-select" id="investment_horizon" name="investment_horizon" required>
                                    <option value="">Sélectionnez...</option>
                                    <option value="court terme">Court terme - Moins de 3 ans</option>
                                    <option value="moyen terme">Moyen terme - 3 à 8 ans</option>
                                    <option value="long terme">Long terme - Plus de 8 ans</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Section 3: Situation personnelle -->
                    <div class="card mb-4 shadow-sm">
                        <div class="card-header bg-light">
                            <h5 class="mb-0">
                                <i class="fas fa-user-friends me-2 text-info"></i>
                                Situation Personnelle
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="family_situation" class="form-label">
                                            Situation familiale *
                                        </label>
                                        <select class="form-select" id="family_situation" name="family_situation" required>
                                            <option value="">Sélectionnez...</option>
                                            <option value="célibataire">Célibataire</option>
                                            <option value="en couple">En couple</option>
                                            <option value="famille avec enfants">Famille avec enfants</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="professional_situation" class="form-label">
                                            Situation professionnelle *
                                        </label>
                                        <select class="form-select" id="professional_situation" name="professional_situation" required>
                                            <option value="">Sélectionnez...</option>
                                            <option value="salarié">Salarié</option>
                                            <option value="indépendant">Indépendant/Freelance</option>
                                            <option value="chef d'entreprise">Chef d'entreprise</option>
                                            <option value="fonctionnaire">Fonctionnaire</option>
                                            <option value="retraité">Retraité</option>
                                            <option value="étudiant">Étudiant</option>
                                            <option value="autre">Autre</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Section 4: Investissements existants -->
                    <div class="card mb-4 shadow-sm">
                        <div class="card-header bg-light">
                            <h5 class="mb-0">
                                <i class="fas fa-chart-pie me-2 text-warning"></i>
                                Investissements Existants
                            </h5>
                        </div>
                        <div class="card-body">
                            <p class="text-muted mb-3">Cochez les investissements que vous possédez déjà et indiquez leur valeur approximative :</p>
                            
                            <!-- Livret A -->
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="has_livret_a" name="has_livret_a" onchange="toggleInvestmentField('livret_a')">
                                        <label class="form-check-label" for="has_livret_a">
                                            <strong>Livret A / LDDS</strong>
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <input type="number" class="form-control" id="livret_a_value" name="livret_a_value" 
                                           min="0" step="100" placeholder="Valeur en €" disabled>
                                </div>
                            </div>

                            <!-- PEA -->
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="has_pea" name="has_pea" onchange="toggleInvestmentField('pea')">
                                        <label class="form-check-label" for="has_pea">
                                            <strong>PEA (Plan Épargne Actions)</strong>
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <input type="number" class="form-control" id="pea_value" name="pea_value" 
                                           min="0" step="500" placeholder="Valeur en €" disabled>
                                </div>
                            </div>

                            <!-- Assurance Vie -->
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="has_life_insurance" name="has_life_insurance" onchange="toggleInvestmentField('life_insurance')">
                                        <label class="form-check-label" for="has_life_insurance">
                                            <strong>Assurance Vie</strong>
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <input type="number" class="form-control" id="life_insurance_value" name="life_insurance_value" 
                                           min="0" step="1000" placeholder="Valeur en €" disabled>
                                </div>
                            </div>

                            <!-- Immobilier -->
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="has_real_estate" name="has_real_estate" onchange="toggleInvestmentField('real_estate')">
                                        <label class="form-check-label" for="has_real_estate">
                                            <strong>Investissement Immobilier</strong>
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <input type="number" class="form-control" id="real_estate_value" name="real_estate_value" 
                                           min="0" step="5000" placeholder="Valeur en €" disabled>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="other_investments" class="form-label">
                                    Autres investissements
                                </label>
                                <textarea class="form-control" id="other_investments" name="other_investments" 
                                          rows="2" placeholder="Décrivez vos autres investissements (crypto, crowdfunding, actions en direct, etc.)"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Boutons de soumission -->
                    <div class="card shadow-sm">
                        <div class="card-body text-center">
                            <div class="mb-3">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="data_consent" required>
                                    <label class="form-check-label" for="data_consent">
                                        J'accepte que mes données soient utilisées pour personnaliser mes conseils financiers *
                                    </label>
                                </div>
                            </div>
                            
                            <button type="submit" class="btn btn-primary btn-lg px-5">
                                <i class="fas fa-check me-2"></i>Finaliser mon profil
                            </button>
                            
                            <div class="mt-3">
                                <small class="text-muted">
                                    <i class="fas fa-lock me-1"></i>
                                    Vos données sont sécurisées et ne seront jamais partagées
                                </small>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function toggleInvestmentField(type) {
    const checkbox = document.getElementById(`has_${type}`);
    const valueField = document.getElementById(`${type}_value`);
    
    if (checkbox.checked) {
        valueField.disabled = false;
        valueField.required = true;
        valueField.focus();
    } else {
        valueField.disabled = true;
        valueField.required = false;
        valueField.value = '';
    }
}

document.addEventListener('DOMContentLoaded', function() {
    // Animation d'entrée des cartes
    const cards = document.querySelectorAll('.card');
    cards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
            card.style.transition = 'all 0.5s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 200);
    });

    // Validation personnalisée
    const form = document.querySelector('form');
    form.addEventListener('submit', function(event) {
        // Vérifier qu'au moins un investissement a une valeur si coché
        const investmentTypes = ['livret_a', 'pea', 'life_insurance', 'real_estate'];
        let hasValidInvestment = true;
        
        investmentTypes.forEach(type => {
            const checkbox = document.getElementById(`has_${type}`);
            const valueField = document.getElementById(`${type}_value`);
            
            if (checkbox.checked && (!valueField.value || parseFloat(valueField.value) <= 0)) {
                hasValidInvestment = false;
                valueField.classList.add('is-invalid');
            } else {
                valueField.classList.remove('is-invalid');
            }
        });
        
        if (!hasValidInvestment) {
            event.preventDefault();
            ToastManager.show('Veuillez saisir une valeur pour chaque investissement coché.', 'warning');
        }
    });

    // Calcul automatique des suggestions
    const incomeField = document.getElementById('monthly_net_income');
    const savingsCapacityField = document.getElementById('monthly_savings_capacity');
    
    incomeField.addEventListener('input', function() {
        const income = parseFloat(this.value) || 0;
        const suggestedSavings = Math.round(income * 0.2); // 20% du revenu
        
        if (income > 0 && !savingsCapacityField.value) {
            savingsCapacityField.placeholder = `Suggestion: ${suggestedSavings}€`;
        }
    });
});
</script>
{% endblock %}