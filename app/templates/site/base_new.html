<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Atlas - Plateforme Patrimoniale{% endblock %}</title>
    
    <!-- Favicon blanc -->
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon-white.png') }}?v=4">
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon-white.png') }}?v=4">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Mobile Navigation Fix -->
    <link href="{{ url_for('static', filename='css/mobile-nav-fix.css') }}" rel="stylesheet">
    <!-- Google Fonts - Inter (exact match to Qlower) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
    :root {
        /* Atlas Color Palette */
        --primary-color: #137C8B;
        --secondary-color: #709CA7;
        --tertiary-color: #B8CBD0;
        --quaternary-color: #7A90A4;
        --dark-color: #344D59;
        
        /* Site vitrine colors (white background) */
        --bg-color: #ffffff;
        --text-primary: #344D59;
        --text-secondary: #7A90A4;
        --text-muted: #709CA7;
        --border-color: #B8CBD0;
        
        /* System colors */
        --success-color: #28a745;
        --danger-color: #dc3545;
        --warning-color: #ffc107;
        --info-color: #17a2b8;
    }

    /* Global Styles */
    * {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    body {
        background-color: var(--bg-color);
        color: var(--text-primary);
        margin: 0;
        padding: 0;
        line-height: 1.6;
    }

    /* Override Bootstrap colors */
    .text-primary { color: var(--primary-color) !important; }
    .bg-primary { background-color: var(--primary-color) !important; }
    .border-primary { border-color: var(--primary-color) !important; }
    .btn-primary { 
        background-color: var(--primary-color) !important; 
        border-color: var(--primary-color) !important; 
    }
    .btn-primary:hover { 
        background-color: var(--secondary-color) !important; 
        border-color: var(--secondary-color) !important; 
    }

    /* ATLAS MODAL - Design moderne et compact */
    .atlas-modal {
        border: none;
        border-radius: 16px;
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        overflow: hidden;
        background: linear-gradient(135deg, #ffffff 0%, #fafbfc 100%);
    }

    .atlas-modal-header {
        position: absolute;
        top: 0;
        right: 0;
        z-index: 10;
        padding: 12px;
    }

    .atlas-modal-close {
        width: 32px;
        height: 32px;
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        border: none;
        border-radius: 8px;
        color: var(--text-secondary);
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .atlas-modal-close:hover {
        background: rgba(255, 255, 255, 1);
        color: var(--primary-color);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
    }

    .atlas-modal-body {
        padding: 0;
    }

    /* Section gauche - Informations */
    .atlas-modal-left {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        color: white;
        position: relative;
        overflow: hidden;
    }

    .atlas-modal-left::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200%;
        height: 200%;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="40" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="40" cy="70" r="1.5" fill="rgba(255,255,255,0.1)"/></svg>');
        animation: float 20s linear infinite;
        pointer-events: none;
    }

    @keyframes float {
        0% { transform: rotate(0deg) translateX(-50%); }
        100% { transform: rotate(360deg) translateX(-50%); }
    }

    .atlas-modal-content-left {
        padding: 32px 24px 24px;
        position: relative;
        z-index: 2;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }

    .atlas-modal-title-section {
        text-align: center;
        margin-bottom: 24px;
    }

    .atlas-modal-icon {
        width: 48px;
        height: 48px;
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(20px);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 16px;
        font-size: 20px;
        color: white;
    }

    .atlas-modal-title {
        font-size: 22px;
        font-weight: 700;
        margin-bottom: 8px;
        line-height: 1.2;
        color: white;
    }

    .atlas-modal-subtitle {
        font-size: 14px;
        opacity: 0.9;
        margin: 0;
        font-weight: 400;
    }

    .atlas-modal-benefits {
        flex: 1;
    }

    .atlas-benefit-item {
        display: flex;
        align-items: flex-start;
        margin-bottom: 12px;
        padding: 10px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        backdrop-filter: blur(10px);
    }

    .atlas-benefit-icon {
        width: 32px;
        height: 32px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 12px;
        flex-shrink: 0;
        color: white;
        font-size: 14px;
    }

    .atlas-benefit-content h6 {
        font-size: 13px;
        font-weight: 600;
        margin-bottom: 2px;
        color: white;
    }

    .atlas-benefit-content p {
        font-size: 12px;
        margin: 0;
        opacity: 0.8;
        line-height: 1.3;
    }

    .atlas-modal-info {
        margin-top: 20px;
    }

    .atlas-info-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
    }

    .atlas-info-item {
        text-align: center;
        padding: 12px 8px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        backdrop-filter: blur(10px);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 70px;
    }

    .atlas-info-item i {
        font-size: 18px;
        margin-bottom: 6px;
        display: block;
        color: white;
    }

    .atlas-info-item strong {
        display: block;
        font-size: 13px;
        font-weight: 700;
        color: white;
        margin-bottom: 2px;
        line-height: 1.2;
    }

    .atlas-info-item span {
        font-size: 11px;
        opacity: 0.9;
        color: white;
        font-weight: 500;
    }

    /* Section droite - Formulaire */
    .atlas-modal-right {
        background: white;
    }

    .atlas-modal-content-right {
        padding: 32px 24px 24px;
        height: 100%;
    }

    .atlas-form-header {
        text-align: center;
        margin-bottom: 24px;
    }

    .atlas-form-header h4 {
        font-size: 20px;
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: 4px;
    }

    .atlas-form-header p {
        color: var(--text-secondary);
        margin: 0;
        font-size: 13px;
    }

    .atlas-appointment-form {
        max-width: 100%;
        margin: 0 auto;
    }

    .atlas-form-group {
        margin-bottom: 16px;
    }

    .atlas-form-label {
        font-size: 12px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 4px;
        display: block;
    }

    .atlas-input-wrapper {
        position: relative;
    }

    .atlas-input-wrapper i {
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-secondary);
        font-size: 14px;
        z-index: 2;
    }

    .atlas-form-input {
        width: 100%;
        padding: 12px 12px 12px 36px;
        border: 2px solid #e8ecef;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        color: var(--text-primary);
        background: #fafbfc;
        transition: all 0.3s ease;
        outline: none;
    }

    .atlas-form-input::placeholder {
        color: var(--text-secondary);
        font-weight: 400;
    }

    .atlas-form-input:focus {
        border-color: var(--primary-color);
        background: white;
        box-shadow: 0 0 0 3px rgba(19, 124, 139, 0.1);
    }

    .atlas-form-input:focus + i {
        color: var(--primary-color);
    }

    .atlas-submit-btn {
        width: 100%;
        padding: 14px 24px;
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        border: none;
        border-radius: 10px;
        color: white;
        font-size: 15px;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        margin-bottom: 12px;
        box-shadow: 0 6px 20px rgba(19, 124, 139, 0.3);
    }

    .atlas-submit-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 32px rgba(19, 124, 139, 0.4);
        background: linear-gradient(135deg, #0f6b75 0%, #5d8a94 100%);
    }

    .atlas-submit-btn:active {
        transform: translateY(0);
    }

    .atlas-btn-content,
    .atlas-btn-loading {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        transition: all 0.3s ease;
    }

    .atlas-btn-loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        opacity: 0;
    }

    .atlas-submit-btn.loading .atlas-btn-content {
        opacity: 0;
    }

    .atlas-submit-btn.loading .atlas-btn-loading {
        opacity: 1;
    }

    .atlas-form-disclaimer {
        text-align: center;
        font-size: 11px;
        color: var(--text-secondary);
        margin: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 8px;
        line-height: 1.3;
    }

    .atlas-form-disclaimer i {
        color: var(--primary-color);
        font-size: 14px;
    }

    /* Messages d'erreur */
    .invalid-feedback {
        font-size: 11px;
        color: #dc3545;
        margin-top: 4px;
        padding-left: 6px;
    }

    /* Responsive */
    @media (max-width: 991px) {
        .atlas-modal-content-left,
        .atlas-modal-content-right {
            padding: 24px 16px 16px;
        }

        .atlas-modal-title {
            font-size: 20px;
        }

        .atlas-info-grid {
            grid-template-columns: 1fr;
            gap: 8px;
        }

        .atlas-benefit-item {
            margin-bottom: 10px;
            padding: 8px;
        }
    }

    @media (max-width: 767px) {
        .modal-lg {
            max-width: 95%;
            margin: 1rem auto;
        }

        .atlas-modal {
            border-radius: 12px;
        }

        .atlas-modal-close {
            width: 28px;
            height: 28px;
            font-size: 12px;
        }

        .atlas-modal-content-left,
        .atlas-modal-content-right {
            padding: 20px 16px 16px;
        }

        .atlas-modal-title {
            font-size: 18px;
        }

        .atlas-form-header h4 {
            font-size: 18px;
        }

        .atlas-modal-icon {
            width: 40px;
            height: 40px;
            font-size: 18px;
        }
    }

    /* FOOTER STYLES - Style menu avec bo√Æte blanche sur fond vert */
    .qlower-footer {
        background: var(--primary-color);
        padding: 60px 24px 24px;
        margin-top: 0;
    }

    .qlower-footer-container {
        max-width: 1200px;
        margin: 0 auto;
        background: var(--bg-color);
        border-radius: 20px;
        padding: 48px 40px 32px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
    }

    .qlower-footer-content {
        display: grid;
        grid-template-columns: 1fr 2fr;
        gap: 60px;
        margin-bottom: 40px;
    }

    .qlower-footer-brand {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .qlower-footer-logo {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 8px;
    }

    .qlower-footer-logo span {
        font-size: 28px;
        font-weight: 700;
        color: var(--dark-color);
        letter-spacing: -0.025em;
    }

    .qlower-footer-description {
        font-size: 16px;
        line-height: 1.6;
        color: var(--text-secondary);
        margin: 0;
        max-width: 280px;
    }

    .qlower-footer-social {
        display: flex;
        gap: 16px;
    }

    .qlower-social-link {
        width: 40px;
        height: 40px;
        background: #f8f9fa;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text-secondary);
        text-decoration: none;
        transition: all 0.3s ease;
    }

    .qlower-social-link:hover {
        background: var(--primary-color);
        color: var(--bg-color);
        transform: translateY(-2px);
    }

    .qlower-footer-links {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 40px;
    }

    .qlower-footer-column h6 {
        font-size: 16px;
        font-weight: 600;
        color: var(--dark-color);
        margin-bottom: 20px;
    }

    .qlower-footer-column ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .qlower-footer-column li {
        margin-bottom: 12px;
    }

    .qlower-footer-link {
        font-size: 15px;
        color: var(--text-secondary);
        text-decoration: none;
        transition: all 0.2s ease;
        display: block;
        padding: 4px 0;
    }

    .qlower-footer-link:hover {
        color: var(--primary-color);
        padding-left: 8px;
    }

    .qlower-footer-bottom {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-top: 32px;
        border-top: 1px solid var(--border-color);
        flex-wrap: wrap;
        gap: 16px;
    }

    .qlower-footer-bottom p {
        font-size: 14px;
        color: var(--text-secondary);
        margin: 0;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .qlower-footer-bottom i {
        color: var(--primary-color);
    }

    /* Footer Responsive */
    @media (max-width: 991px) {
        .qlower-footer-content {
            grid-template-columns: 1fr;
            gap: 40px;
        }
        
        .qlower-footer-links {
            grid-template-columns: repeat(2, 1fr);
            gap: 30px;
        }
    }

    @media (max-width: 767px) {
        .qlower-footer-container {
            padding: 32px 24px 24px;
        }
        
        .qlower-footer-links {
            grid-template-columns: 1fr;
            gap: 24px;
        }
        
        .qlower-footer-bottom {
            flex-direction: column;
            text-align: center;
            gap: 12px;
        }
    }
    </style>
    
    {% block head %}{% endblock %}
</head>
<body>
    <!-- Messages Flash -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="position-fixed top-0 end-0 p-3" style="z-index: 1055; margin-top: 80px;">
                {% for category, message in messages %}
                    <div class="toast align-items-center text-white bg-{{ 'danger' if category == 'error' else 'success' if category == 'success' else 'primary' }} border-0 show" role="alert">
                        <div class="d-flex">
                            <div class="toast-body">
                                <i class="fas fa-{{ 'exclamation-triangle' if category == 'error' else 'check-circle' if category == 'success' else 'info-circle' }} me-2"></i>
                                {{ message }}
                            </div>
                            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Contenu principal -->
    <main>
        {% block content %}{% endblock %}
    </main>

    <!-- Footer centralis√© -->
    {% block footer %}
    <footer class="qlower-footer">
        <div class="qlower-footer-container">
            <div class="qlower-footer-content">
                <div class="qlower-footer-brand">
                    <div class="qlower-footer-logo">
                        <img src="{{ url_for('static', filename='images/logo-atlas.png') }}" alt="Atlas" style="height: 28px; width: auto;">
                    </div>
                    <p class="qlower-footer-description">
                        Votre plateforme patrimoniale digitale. Optimisez vos finances avec nos conseils personnalis√©s.
                    </p>
                    <div class="qlower-footer-social">
                        <a href="#" class="qlower-social-link"><i class="fab fa-linkedin"></i></a>
                        <a href="#" class="qlower-social-link"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="qlower-social-link"><i class="fab fa-facebook"></i></a>
                        <a href="#" class="qlower-social-link"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
                
                <div class="qlower-footer-links">
                    <div class="qlower-footer-column">
                        <h6>Produit</h6>
                        <ul>
                            <li><a href="{{ url_for('site_pages.solutions') }}" class="qlower-footer-link">Nos solutions</a></li>
                            <li><a href="{{ url_for('site_pages.pricing') }}" class="qlower-footer-link">Tarifs</a></li>
                            <li><a href="#" class="qlower-footer-link">S√©curit√©</a></li>
                            <li><a href="#" class="qlower-footer-link">Simulateur</a></li>
                        </ul>
                    </div>
                    
                    <div class="qlower-footer-column">
                        <h6>Ressources</h6>
                        <ul>
                            <li><a href="#" class="qlower-footer-link">Blog</a></li>
                            <li><a href="#" class="qlower-footer-link">Guides</a></li>
                            <li><a href="#" class="qlower-footer-link">FAQ</a></li>
                            <li><a href="{{ url_for('site_pages.contact') }}" class="qlower-footer-link">Contact</a></li>
                        </ul>
                    </div>
                    
                    <div class="qlower-footer-column">
                        <h6>Entreprise</h6>
                        <ul>
                            <li><a href="{{ url_for('site_pages.about') }}" class="qlower-footer-link">√Ä propos</a></li>
                            <li><a href="#" class="qlower-footer-link">Devenir Partenaire</a></li>
                            <li><a href="#" class="qlower-footer-link">Carri√®res</a></li>
                            <li><a href="#" class="qlower-footer-link">Presse</a></li>
                        </ul>
                    </div>
                    
                    <div class="qlower-footer-column">
                        <h6>L√©gal</h6>
                        <ul>
                            <li><a href="{{ url_for('site_pages.cgu') }}" class="qlower-footer-link">CGU</a></li>
                            <li><a href="{{ url_for('site_pages.privacy') }}" class="qlower-footer-link">Confidentialit√©</a></li>
                            <li><a href="{{ url_for('site_pages.cookies') }}" class="qlower-footer-link">Cookies</a></li>
                            <li><a href="{{ url_for('site_pages.legal') }}" class="qlower-footer-link">Mentions l√©gales</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="qlower-footer-bottom">
                <p>&copy; 2026 Atlas. Tous droits r√©serv√©s.</p>
                <p>
                    <i class="fas fa-shield-alt"></i>
                    Donn√©es s√©curis√©es et crypt√©es
                </p>
            </div>
        </div>
    </footer>
    {% endblock %}

    <!-- Modal de prise de RDV - 2 √©tapes : Formulaire puis Cal.com -->
    <div class="modal fade" id="appointmentModal" tabindex="-1" aria-labelledby="appointmentModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered" id="modal-dialog">
            <div class="modal-content atlas-modal">
                <!-- Header avec fermeture √©l√©gante -->
                <div class="atlas-modal-header">
                    <button type="button" class="atlas-modal-close" data-bs-dismiss="modal" aria-label="Fermer">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <!-- √âTAPE 1 : Formulaire de contact -->
                <div id="step-1" class="atlas-modal-body">
                    <div class="row g-0">
                        <!-- Section gauche - Informations -->
                        <div class="col-lg-6 atlas-modal-left">
                            <div class="atlas-modal-content-left">
                                <!-- Titre principal -->
                                <div class="atlas-modal-title-section">
                                    <div class="atlas-modal-icon">
                                        <i class="fas fa-calendar-alt"></i>
                                    </div>
                                    <h2 class="atlas-modal-title">
                                        Rencontrer votre futur conseiller Atlas
                                    </h2>
                                    <p class="atlas-modal-subtitle">
                                        D√©couvrez comment Atlas peut vous aider
                                    </p>
                                </div>
                                
                                <!-- Avantages -->
                                <div class="atlas-modal-benefits">
                                    <div class="atlas-benefit-item">
                                        <div class="atlas-benefit-icon">
                                            <i class="fas fa-comments"></i>
                                        </div>
                                        <div class="atlas-benefit-content">
                                            <h6>√âchange autour de vos projets</h6>
                                            <p>Discussion sur vos objectifs financiers</p>
                                        </div>
                                    </div>
                                    
                                    <div class="atlas-benefit-item">
                                        <div class="atlas-benefit-icon">
                                            <i class="fas fa-search-dollar"></i>
                                        </div>
                                        <div class="atlas-benefit-content">
                                            <h6>Analyse de votre situation financi√®re</h6>
                                            <p>Diagnostic complet de votre profil</p>
                                        </div>
                                    </div>
                                    
                                    <div class="atlas-benefit-item">
                                        <div class="atlas-benefit-icon">
                                            <i class="fas fa-laptop-code"></i>
                                        </div>
                                        <div class="atlas-benefit-content">
                                            <h6>Pr√©sentation des services Atlas</h6>
                                            <p>D√©couverte de nos solutions d'accompagnement</p>
                                        </div>
                                    </div>
                                    
                                    <div class="atlas-benefit-item">
                                        <div class="atlas-benefit-icon">
                                            <i class="fas fa-bullseye"></i>
                                        </div>
                                        <div class="atlas-benefit-content">
                                            <h6>Strat√©gie d'investissement personnalis√©e</h6>
                                            <p>Plan d'action adapt√© √† vos besoins</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Informations pratiques -->
                                <div class="atlas-modal-info">
                                    <div class="atlas-info-grid">
                                        <div class="atlas-info-item">
                                            <i class="fas fa-clock"></i>
                                            <div>
                                                <strong>30 min</strong>
                                            </div>
                                        </div>
                                        <div class="atlas-info-item">
                                            <i class="fas fa-phone"></i>
                                            <div>
                                                <strong>T√©l√©phone ou visio</strong>
                                            </div>
                                        </div>
                                        <div class="atlas-info-item">
                                            <i class="fas fa-gift"></i>
                                            <div>
                                                <strong>Offert et sans engagement</strong>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Section droite - Formulaire -->
                        <div class="col-lg-6 atlas-modal-right">
                            <div class="atlas-modal-content-right">
                                <div class="atlas-form-header">
                                    <h4>Vos informations</h4>
                                    <p>Nous vous recontactons rapidement</p>
                                </div>
                                
                                <form id="appointmentForm" class="atlas-appointment-form needs-validation" novalidate>
                                    <div class="atlas-form-group">
                                        <label for="lastName" class="atlas-form-label">Nom *</label>
                                        <div class="atlas-input-wrapper">
                                            <i class="fas fa-user"></i>
                                            <input type="text" class="atlas-form-input" id="lastName" name="lastName" placeholder="Votre nom" required>
                                        </div>
                                        <div class="invalid-feedback">
                                            Veuillez saisir votre nom.
                                        </div>
                                    </div>
                                    
                                    <div class="atlas-form-group">
                                        <label for="firstName" class="atlas-form-label">Pr√©nom *</label>
                                        <div class="atlas-input-wrapper">
                                            <i class="fas fa-user"></i>
                                            <input type="text" class="atlas-form-input" id="firstName" name="firstName" placeholder="Votre pr√©nom" required>
                                        </div>
                                        <div class="invalid-feedback">
                                            Veuillez saisir votre pr√©nom.
                                        </div>
                                    </div>
                                    
                                    <div class="atlas-form-group">
                                        <label for="email" class="atlas-form-label">Votre adresse mail *</label>
                                        <div class="atlas-input-wrapper">
                                            <i class="fas fa-envelope"></i>
                                            <input type="email" class="atlas-form-input" id="email" name="email" placeholder="votre.email@exemple.fr" required>
                                        </div>
                                        <div class="invalid-feedback">
                                            Veuillez saisir une adresse email valide.
                                        </div>
                                    </div>
                                    
                                    <div class="atlas-form-group">
                                        <label for="phone" class="atlas-form-label">Num√©ro de t√©l√©phone *</label>
                                        <div class="atlas-input-wrapper">
                                            <i class="fas fa-phone"></i>
                                            <input type="tel" class="atlas-form-input" id="phone" name="phone" placeholder="06 12 34 56 78" required>
                                        </div>
                                        <div class="invalid-feedback">
                                            Veuillez saisir votre num√©ro de t√©l√©phone.
                                        </div>
                                    </div>
                                    
                                    <button type="submit" class="atlas-submit-btn" id="submitAppointment">
                                        <span class="atlas-btn-content">
                                            <i class="fas fa-calendar-check"></i>
                                            <span>Continuer et prendre rendez-vous</span>
                                        </span>
                                        <div class="atlas-btn-loading">
                                            <i class="fas fa-spinner fa-spin"></i>
                                            <span>Traitement en cours...</span>
                                        </div>
                                    </button>
                                    
                                    <p class="atlas-form-disclaimer">
                                        <i class="fas fa-shield-alt"></i>
                                        Vos donn√©es sont s√©curis√©es. Le calendrier s'affichera ensuite.
                                    </p>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- √âTAPE 2 : Calendrier Cal.com -->
                <div id="step-2" class="d-none">
                    <!-- Header √©tape 2 -->
                    <div class="atlas-step2-header">
                        <button type="button" class="atlas-back-btn" onclick="goBackToStep1()">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <div class="atlas-step2-title">
                            <h3>Choisissez votre cr√©neau</h3>
                            <p>Merci <span id="userName"></span> ! S√©lectionnez le cr√©neau qui vous convient.</p>
                        </div>
                    </div>
                    
                    <!-- Body √©tape 2 -->
                    <div class="atlas-step2-body">
                        <!-- Loader pendant le chargement -->
                        <div id="cal-loader" class="text-center p-4">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Chargement...</span>
                            </div>
                            <p class="mt-3 text-muted">Chargement du calendrier...</p>
                        </div>
                        
                        <!-- Container pour Cal.com -->
                        <div id="cal-embed-container" class="d-none">
                            <!-- L'embed Cal.com sera inject√© ici -->
                        </div>
                        
                        <!-- Fallback en cas d'erreur -->
                        <div id="cal-fallback" class="d-none text-center p-4">
                            <div class="mb-4">
                                <i class="fas fa-exclamation-triangle text-warning fs-1 mb-3"></i>
                                <h6 class="fw-bold mb-3">Impossible de charger le calendrier</h6>
                                <p class="text-muted mb-4">
                                    Une erreur s'est produite lors du chargement du calendrier.
                                </p>
                            </div>
                            <div class="d-flex gap-3 justify-content-center">
                                <a href="https://app.cal.com/atlas-finance/30min" 
                                   target="_blank" 
                                   class="btn btn-primary">
                                    <i class="fas fa-external-link-alt me-2"></i>
                                    Ouvrir le calendrier
                                </a>
                                <button type="button" 
                                        class="btn btn-secondary" 
                                        onclick="reloadCalEmbed()">
                                    <i class="fas fa-redo me-2"></i>
                                    R√©essayer
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- CSS pour le modal 2 √©tapes -->
    <style>
        /* √âTAPE 2 - Styles sp√©cifiques */
        #step-2 {
            min-height: 600px;
            position: relative;
            background: linear-gradient(135deg, #ffffff 0%, #fafbfc 100%);
        }
        
        /* Header √©tape 2 */
        .atlas-step2-header {
            position: relative;
            padding: 24px 32px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .atlas-back-btn {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .atlas-back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateX(-2px);
        }
        
        .atlas-step2-title h3 {
            font-size: 24px;
            font-weight: 700;
            margin: 0;
            margin-bottom: 4px;
        }
        
        .atlas-step2-title p {
            font-size: 16px;
            opacity: 0.9;
            margin: 0;
        }
        
        /* Body √©tape 2 */
        .atlas-step2-body {
            position: relative;
            min-height: 500px;
        }
        
        /* Container Cal.com pour √©tape 2 */
        #cal-embed-container {
            width: 100%;
            height: 500px;
            position: relative;
            background: white;
        }
        
        #cal-embed-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        /* Responsive design pour √©tape 2 */
        @media (max-width: 768px) {
            #modal-dialog.modal-lg-expanded {
                max-width: 95vw;
                margin: 10px;
            }
            
            .atlas-step2-header {
                padding: 20px 24px;
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .atlas-step2-title h3 {
                font-size: 20px;
            }
            
            .atlas-step2-body {
                min-height: 400px;
            }
            
            #cal-embed-container {
                height: 400px;
            }
        }
        
        @media (max-width: 576px) {
            .atlas-step2-header {
                padding: 16px 20px;
            }
            
            .atlas-step2-title h3 {
                font-size: 18px;
            }
            
            .atlas-step2-title p {
                font-size: 14px;
            }
            
            .atlas-step2-body {
                min-height: 350px;
            }
            
            #cal-embed-container {
                height: 350px;
            }
        }
        
        /* Transitions fluides entre √©tapes */
        .step-transition {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .step-fade-out {
            opacity: 0;
            transform: translateX(-30px);
        }
        
        .step-fade-in {
            opacity: 1;
            transform: translateX(0);
        }
        
        /* Loading animation */
        .spinner-border {
            width: 3rem;
            height: 3rem;
        }
        
        /* Fallback buttons styling */
        #cal-fallback .btn {
            min-width: 180px;
        }
        
        /* Animation d'entr√©e userName */
        #userName {
            color: #FFE4B5;
            font-weight: 600;
        }
    </style>

    <!-- Script pour le modal 2 √©tapes avec Cal.com -->
    <script>
        // Variables globales
        let calEmbed = null;
        let calLoadTimeout = null;
        let currentStep = 1;
        let userProspectData = null;
        const EMBED_TIMEOUT = 10000; // 10 secondes

        document.addEventListener('DOMContentLoaded', function() {
            const appointmentForm = document.getElementById('appointmentForm');
            const submitButton = document.getElementById('submitAppointment');
            const appointmentModal = document.getElementById('appointmentModal');
            
            // Gestion du formulaire
            if (appointmentForm) {
                appointmentForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    // Validation du formulaire
                    if (!appointmentForm.checkValidity()) {
                        e.stopPropagation();
                        appointmentForm.classList.add('was-validated');
                        return;
                    }
                    
                    // D√©sactiver le bouton pendant l'envoi
                    submitButton.disabled = true;
                    submitButton.classList.add('loading');
                    
                    // R√©cup√©ration des donn√©es du formulaire
                    const formData = {
                        firstName: document.getElementById('firstName').value.trim(),
                        lastName: document.getElementById('lastName').value.trim(),
                        email: document.getElementById('email').value.trim(),
                        phone: document.getElementById('phone').value.trim()
                    };
                    
                    userProspectData = formData; // Sauvegarder les donn√©es
                    
                    try {
                        // Envoi des donn√©es au serveur
                        const response = await fetch('/site/api/prospect', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(formData)
                        });
                        
                        const result = await response.json();
                        
                        if (result.success) {
                            // Passer √† l'√©tape 2 avec animation
                            showNotification('Informations enregistr√©es avec succ√®s !', 'success');
                            setTimeout(() => {
                                goToStep2();
                            }, 800);
                            
                        } else {
                            showNotification(result.error || 'Une erreur est survenue', 'error');
                        }
                        
                    } catch (error) {
                        console.error('Erreur:', error);
                        showNotification('Erreur de connexion. Veuillez r√©essayer.', 'error');
                    } finally {
                        // R√©activer le bouton
                        submitButton.disabled = false;
                        submitButton.classList.remove('loading');
                    }
                });
            }
            
            // Reset du modal √† la fermeture
            if (appointmentModal) {
                appointmentModal.addEventListener('hidden.bs.modal', function() {
                    resetModal();
                });
            }
        });

        // Fonctions de navigation entre √©tapes
        function goToStep2() {
            currentStep = 2;
            
            const step1 = document.getElementById('step-1');
            const step2 = document.getElementById('step-2');
            const modalDialog = document.getElementById('modal-dialog');
            const userName = document.getElementById('userName');
            
            // Afficher le nom de l'utilisateur
            if (userProspectData) {
                userName.textContent = userProspectData.firstName;
            }
            
            // Ajouter classes de transition
            step1.classList.add('step-transition');
            
            // Animation de sortie √©tape 1
            step1.classList.add('step-fade-out');
            
            setTimeout(() => {
                // Cacher √©tape 1, montrer √©tape 2
                step1.classList.add('d-none');
                step2.classList.remove('d-none');
                
                // Agrandir le modal pour le calendrier
                modalDialog.classList.add('modal-lg-expanded');
                
                // Animation d'entr√©e √©tape 2
                step2.classList.add('step-transition', 'step-fade-in');
                
                // Charger Cal.com
                loadCalEmbed();
                
            }, 400);
        }

        function goBackToStep1() {
            currentStep = 1;
            
            const step1 = document.getElementById('step-1');
            const step2 = document.getElementById('step-2');
            const modalDialog = document.getElementById('modal-dialog');
            
            // Animation de sortie √©tape 2
            step2.classList.add('step-fade-out');
            
            setTimeout(() => {
                // Cacher √©tape 2, montrer √©tape 1
                step2.classList.add('d-none');
                step1.classList.remove('d-none');
                
                // Remettre la taille normale du modal
                modalDialog.classList.remove('modal-lg-expanded');
                
                // Animation d'entr√©e √©tape 1
                step1.classList.remove('step-fade-out');
                step1.classList.add('step-fade-in');
                
                // Nettoyer Cal.com
                cleanupCalEmbed();
                
            }, 400);
        }

        function resetModal() {
            // Reset √† l'√©tape 1
            currentStep = 1;
            userProspectData = null;
            
            const step1 = document.getElementById('step-1');
            const step2 = document.getElementById('step-2');
            const modalDialog = document.getElementById('modal-dialog');
            const form = document.getElementById('appointmentForm');
            
            // Reset des √©l√©ments
            step1.classList.remove('d-none', 'step-transition', 'step-fade-out', 'step-fade-in');
            step2.classList.add('d-none');
            step2.classList.remove('step-transition', 'step-fade-out', 'step-fade-in');
            modalDialog.classList.remove('modal-lg-expanded');
            
            // Reset du formulaire
            if (form) {
                form.reset();
                form.classList.remove('was-validated');
            }
            
            // Nettoyer Cal.com
            cleanupCalEmbed();
            
            console.log('üîÑ Modal reset √† l\'√©tape 1');
        }

        // Fonction pour charger l'embed Cal.com
        function loadCalEmbed() {
            const container = document.getElementById('cal-embed-container');
            const loader = document.getElementById('cal-loader');
            const fallback = document.getElementById('cal-fallback');
            
            // Reset des √©tats
            container.classList.add('d-none');
            fallback.classList.add('d-none');
            loader.classList.remove('d-none');
            
            try {
                // Nettoyer le container
                container.innerHTML = '';
                
                // Cr√©er le container Cal.com
                const calDiv = document.createElement('div');
                calDiv.style.width = '100%';
                calDiv.style.height = '100%';
                calDiv.style.overflow = 'scroll';
                calDiv.id = 'my-cal-inline-30min';
                container.appendChild(calDiv);
                
                // Charger le script Cal.com et initialiser l'embed
                (function (C, A, L) { 
                    let p = function (a, ar) { a.q.push(ar); }; 
                    let d = C.document; 
                    C.Cal = C.Cal || function () { 
                        let cal = C.Cal; 
                        let ar = arguments; 
                        if (!cal.loaded) { 
                            cal.ns = {}; 
                            cal.q = cal.q || []; 
                            d.head.appendChild(d.createElement("script")).src = A; 
                            cal.loaded = true; 
                        } 
                        if (ar[0] === L) { 
                            const api = function () { p(api, arguments); }; 
                            const namespace = ar[1]; 
                            api.q = api.q || []; 
                            if(typeof namespace === "string"){
                                cal.ns[namespace] = cal.ns[namespace] || api;
                                p(cal.ns[namespace], ar);
                                p(cal, ["initNamespace", namespace]);
                            } else p(cal, ar); 
                            return;
                        } 
                        p(cal, ar); 
                    }; 
                })(window, "https://app.cal.com/embed/embed.js", "init");
                
                Cal("init", "30min", {origin:"https://app.cal.com"});

                Cal.ns["30min"]("inline", {
                    elementOrSelector:"#my-cal-inline-30min",
                    config: {"layout":"month_view"},
                    calLink: "atlas-finance/30min",
                });

                Cal.ns["30min"]("ui", {
                    "cssVarsPerTheme":{"light":{"cal-brand":"#137C8B"}},
                    "hideEventTypeDetails":false,
                    "layout":"month_view"
                });
                
                // Masquer le loader et afficher le container apr√®s un court d√©lai
                setTimeout(function() {
                    clearTimeout(calLoadTimeout);
                    loader.classList.add('d-none');
                    container.classList.remove('d-none');
                    console.log('‚úÖ Cal.com embed charg√© avec succ√®s');
                }, 2000);
                
                calEmbed = calDiv;
                
            } catch (error) {
                console.error('‚ùå Erreur lors de la cr√©ation de l\'embed:', error);
                showCalFallback();
            }
            
            // Timeout de s√©curit√©
            calLoadTimeout = setTimeout(function() {
                if (container.classList.contains('d-none')) {
                    showCalFallback();
                    console.warn('‚è∞ Timeout: Cal.com prend trop de temps √† charger');
                }
            }, EMBED_TIMEOUT);
        }

        // Fonction pour afficher le fallback
        function showCalFallback() {
            const container = document.getElementById('cal-embed-container');
            const loader = document.getElementById('cal-loader');
            const fallback = document.getElementById('cal-fallback');
            
            loader.classList.add('d-none');
            container.classList.add('d-none');
            fallback.classList.remove('d-none');
        }

        // Fonction pour r√©essayer le chargement
        function reloadCalEmbed() {
            console.log('üîÑ Rechargement de l\'embed Cal.com...');
            cleanupCalEmbed();
            setTimeout(() => {
                loadCalEmbed();
            }, 500);
        }

        // Fonction pour nettoyer l'embed
        function cleanupCalEmbed() {
            if (calLoadTimeout) {
                clearTimeout(calLoadTimeout);
                calLoadTimeout = null;
            }
            
            const container = document.getElementById('cal-embed-container');
            if (container) {
                container.innerHTML = '';
            }
            
            // Nettoyer les objets Cal.com globaux
            if (window.Cal && window.Cal.ns && window.Cal.ns["30min"]) {
                try {
                    // Essayer de nettoyer l'instance Cal.com
                    delete window.Cal.ns["30min"];
                } catch (e) {
                    console.warn('Erreur lors du nettoyage Cal.com:', e);
                }
            }
            
            calEmbed = null;
            console.log('üßπ Cal.com embed nettoy√©');
        }

        // Fonction pour afficher les notifications
        function showNotification(message, type) {
            const alertClass = type === 'success' ? 'alert-success' : 'alert-danger';
            const iconClass = type === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-triangle';
            
            const notification = document.createElement('div');
            notification.className = `alert ${alertClass} alert-dismissible fade show position-fixed`;
            notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            notification.innerHTML = `
                <i class="${iconClass} me-2"></i>${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(notification);
            
            // Supprimer automatiquement apr√®s 5 secondes
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }

        // Gestion du message de booking r√©ussi
        window.addEventListener('message', function(e) {
            if (e.origin === 'https://app.cal.com') {
                if (e.data.type === 'booking_completed') {
                    console.log('üéâ Rendez-vous r√©serv√© avec succ√®s!');
                    showNotification('Parfait ! Votre rendez-vous est confirm√©. Vous allez recevoir un email de confirmation.', 'success');
                    
                    // Fermer le modal apr√®s 2 secondes
                    setTimeout(() => {
                        const modal = bootstrap.Modal.getInstance(document.getElementById('appointmentModal'));
                        if (modal) modal.hide();
                    }, 2000);
                }
            }
        });
    </script>
    
    {% block scripts %}{% endblock %}
</body>
</html>